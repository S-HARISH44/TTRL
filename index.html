<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Turbo Tribe Racing League - Elite F1 25 Sim Racing Competition">
    <title>TTRL | Racing League</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    <style>
        :root {
            --bg-main: #050505;
            --accent-red: #ff1f4b;
            --accent-cyan: #00f0ff;
            --text-primary: #ffffff;
            --glass-border: rgba(255, 255, 255, 0.15);
            --glass-bg: rgba(20, 20, 20, 0.95);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; cursor: none; }
        
        html, body {
            width: 100%; height: 100%; margin: 0; padding: 0;
            background-color: var(--bg-main);
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            overflow: hidden;
            overscroll-behavior: none;
        }

        /* --- UPDATED CUSTOM CURSOR --- */
        #cursor-follower { display: none; }

        #cursor, #cursor-follower {
            position: fixed; top: 0; left: 0; pointer-events: none; 
            z-index: 99999; /* Increased z-index to be above modals */
            transform: translate(-50%, -50%);
            will-change: transform, left, top;
        }
        #cursor {
            width: 12px; height: 12px; 
            background: var(--accent-cyan);
            transform: translate(-50%, -50%) rotate(45deg); 
            transition: width 0.2s, height 0.2s, background 0.2s;
            box-shadow: 0 0 15px var(--accent-cyan);
            mix-blend-mode: difference;
        }
        
        body.hovering #cursor { 
            transform: translate(-50%, -50%) rotate(45deg) scale(1.5);
            background: var(--accent-red);
            box-shadow: 0 0 20px var(--accent-red);
        }

        @media (max-width: 768px) {
            * { cursor: auto !important; }
            #cursor, #cursor-follower { display: none !important; }
        }

        /* --- LOADER --- */
        #loader {
            position: fixed; inset: 0; z-index: 10000; background: #000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .loader-bar { width: 200px; height: 2px; background: #333; margin-top: 20px; position: relative; overflow: hidden; }
        .loader-progress {
            position: absolute; top: 0; left: 0; height: 100%; width: 0%;
            background: var(--accent-cyan); box-shadow: 0 0 10px var(--accent-cyan);
        }

        /* --- UI COMPONENTS --- */
        .fixed-ui {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 100;
            padding: 1rem 2rem;
            display: flex; justify-content: space-between; align-items: center;
            pointer-events: none;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, transparent 100%);
        }
        
        .logo { height: 3.5rem; width: auto; pointer-events: auto; cursor: pointer; transition: transform 0.3s ease; }
        .logo:hover { transform: scale(1.05); }
        .header-right { display: flex; align-items: center; gap: 1.5rem; }
        
        .top-nav {
            display: flex; gap: 1rem; pointer-events: auto;
            font-family: 'Rajdhani', sans-serif; font-weight: 700;
            text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.9rem;
        }
        .top-nav a {
            color: rgba(255, 255, 255, 0.6); text-decoration: none; position: relative;
            padding: 0.5rem 0.5rem; transition: color 0.3s ease; cursor: pointer;
        }
        .top-nav a:hover { color: var(--accent-cyan); }
        .top-nav a::after {
            content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 0; height: 2px; background: var(--accent-red); transition: width 0.3s ease;
        }
        .top-nav a.active { color: var(--text-primary); }
        .top-nav a.active::after { width: 100%; background: var(--accent-cyan); }
        
        /* --- SLIDES --- */
        .slides-wrapper { position: fixed; inset: 0; width: 100%; height: 100%; }
        .slide {
            position: absolute; inset: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            visibility: hidden; overflow: hidden; opacity: 0;
            will-change: opacity, transform;
        }
        .slide.active { visibility: visible; z-index: 10; opacity: 1; }

        .slide-bg {
            position: absolute; inset: 0; z-index: 1;
            background-size: cover; background-position: center;
            filter: brightness(0.3) grayscale(0.2);
            transform: scale(1.1); will-change: transform;
        }
        #vanta-bg { filter: brightness(1) grayscale(0); }
        #vanta-bg canvas { width: 100% !important; height: 100% !important; }

        .slide-content {
            position: relative; z-index: 3; max-width: 1400px; width: 100%; padding: 0 4vw;
            display: flex; flex-direction: column; justify-content: center; height: 100%;
        }
        
        #slide-2 .slide-content, #slide-5 .slide-content { justify-content: flex-start; padding-top: 6vh; }

        /* --- TYPOGRAPHY --- */
        .tech-font { font-family: 'Rajdhani', sans-serif; text-transform: uppercase; line-height: 0.9; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }
        
        .slide-tag {
            display: inline-block; padding: 0.3rem 0.8rem; margin-bottom: 1rem;
            border-left: 2px solid var(--accent-cyan); color: var(--accent-cyan);
            font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.2em;
            background: linear-gradient(90deg, rgba(0, 240, 255, 0.1), transparent);
        }
        
        .slide-title {
            font-size: clamp(2rem, 5vw, 4rem); font-weight: 800; margin-bottom: 0.5rem;
            color: #fff; position: relative; z-index: 2; mix-blend-mode: hard-light;
        }
        .text-outline { -webkit-text-stroke: 1px rgba(255,255,255,0.85); color: transparent; }

        /* =========================================
           HOME DESIGN CSS
           ========================================= */
        .home-design-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
            position: relative;
            z-index: 5;
            padding-top: 4rem; 
        }
        .home-title-group {
            text-align: center;
            margin-bottom: 1.5rem;
            line-height: 0.85;
        }
        .home-title-main {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 800;
            font-size: clamp(3rem, 7vw, 6rem);
            color: #fff;
            text-transform: uppercase;
            display: flex; gap: 0.5em; justify-content: center;
        }
        .home-title-sub {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 800;
            font-size: clamp(2rem, 5vw, 4.5rem);
            color: #fff;
            text-transform: uppercase;
            display: flex; gap: 0.5em; justify-content: center;
        }
        .text-fill { color: #fff; }
        .text-stroke {
            color: transparent;
            -webkit-text-stroke: 1px #fff;
        }
        .home-countdown {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .cd-box {
            background: rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 0.8rem 1.2rem;
            text-align: center;
            min-width: 80px;
            backdrop-filter: blur(5px);
        }
        .cd-number {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 2rem;
            color: #fff;
            display: block;
            line-height: 1;
        }
        .cd-label {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            font-size: 0.8rem;
            color: var(--accent-red);
            text-transform: uppercase;
            margin-top: 0.2rem;
            display: block;
        }
        
        .next-race-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: var(--accent-cyan);
            letter-spacing: 0.2em;
            text-transform: uppercase;
            margin-bottom: 3rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 240, 255, 0.1);
            border: 1px solid rgba(0, 240, 255, 0.3);
            border-radius: 4px;
            text-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
        }

        .home-cards-container {
            display: flex;
            gap: 2rem;
            width: 100%;
            max-width: 1200px;
            padding: 0 2rem;
            justify-content: center;
            align-items: stretch;
        }
        .home-card {
            flex: 1;
            max-width: 500px;
            height: 250px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            border-radius: 4px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 2rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-decoration: none;
        }
        .home-card::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(to right, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.4) 60%, transparent 100%);
            z-index: 1;
        }
        .home-card:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(0,0,0,0.7); }
        .hc-content { position: relative; z-index: 2; width: 100%; }
        .hc-tag {
            color: var(--accent-red);
            font-family: 'Rajdhani', sans-serif;
            font-weight: 800;
            font-size: 1.2rem;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            display: block;
        }
        .hc-sub {
            color: #ccc;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            text-transform: uppercase;
            margin-bottom: 0.2rem;
            display: block;
        }
        .hc-title {
            color: #fff;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 800;
            font-size: 2.2rem;
            text-transform: uppercase;
            line-height: 1;
            margin-bottom: 1.5rem;
            display: block;
        }
        .hc-btn {
            display: inline-block;
            padding: 0.6rem 1.5rem;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.9rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: #fff;
            pointer-events: auto;
        }
        .hc-btn-red { background-color: #D00000; }
        .hc-btn-red:hover { background-color: #ff0000; }
        .hc-btn-grey { background-color: #444; color: #fff; }
        .hc-btn-grey:hover { background-color: #666; }
        
        @media (max-width: 900px) {
            .home-cards-container { flex-direction: column; align-items: center; }
            .home-card { width: 100%; height: 200px; }
            .home-title-main, .home-title-sub { font-size: 3rem; }
        }

        /* --- STANDINGS --- */
        .standings-tabs { display: flex; gap: 1rem; margin-bottom: 1rem; overflow-x: auto; padding-bottom: 5px;}
        .tab-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.2); color: rgba(255,255,255,0.5);
            padding: 0.5rem 1.5rem; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 0.9rem;
            text-transform: uppercase; letter-spacing: 0.1em; pointer-events: auto; transition: all 0.3s ease;
            white-space: nowrap; cursor: pointer;
        }
        .tab-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .tab-btn.active { background: var(--accent-red); color: #fff; border-color: var(--accent-red); box-shadow: 0 0 20px rgba(255,31,75,0.3); }

        .standings-wrapper { width: 100%; height: 75vh; margin-top: 0.5rem; position: relative; }
        .standings-view {
            position: absolute; inset: 0; width: 100%; height: 100%;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0; visibility: hidden; transform: translateY(20px); pointer-events: none;
        }
        .standings-view.active-view { opacity: 1; visibility: visible; transform: translateY(0); pointer-events: auto; }

        .table-scroll { height: 100%; overflow: auto; padding-right: 1rem; scrollbar-width: none; }
        .table-scroll::-webkit-scrollbar { display: none; }
        
        /* FIXED TABLE STYLES */
        .standings-table { 
            width: 100%; 
            border-collapse: separate; 
            border-spacing: 0; 
            font-family: 'JetBrains Mono', monospace; 
        }
        
        .standings-table th {
            text-align: left; color: var(--accent-cyan); padding: 0.8rem;
            position: sticky; top: 0; 
            background: #050505; 
            z-index: 30; 
            font-family: 'Rajdhani', sans-serif; font-weight: 700; letter-spacing: 0.1em;
            white-space: nowrap; font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        
        .standings-table td { 
            padding: 0.8rem; 
            background: var(--glass-bg); 
            border-top: 1px solid transparent; 
            border-bottom: 1px solid transparent; 
            transition: all 0.2s ease; 
            white-space: nowrap; 
            font-size: 0.9rem;
        }

        .standings-table td:first-child, .standings-table th:first-child { position: sticky; left: 0; }
        .standings-table th:first-child { z-index: 40; background: #050505; border-right: 1px solid rgba(255,255,255,0.1); }
        .standings-table td:first-child { 
            z-index: 20; background: #0a0a0a; border-radius: 4px 0 0 4px; 
            border-left: 3px solid var(--team-color, transparent); 
            border-right: 1px solid rgba(255,255,255,0.1);
            box-shadow: 2px 0 5px rgba(0,0,0,0.5);
        }
        .standings-table td:last-child { border-radius: 0 4px 4px 0; border-right: 1px solid transparent; }
        .standings-table tr:hover td { background: rgba(255, 255, 255, 0.1); transform: scale(1.01); }
        .standings-table tr:hover td:first-child { background: #111; } 
        
        .team-cell { display: flex; align-items: center; gap: 0.8rem; }
        .team-logo-mini { height: 20px; width: auto; max-width: 30px; object-fit: contain; }

        /* --- GARAGE GRID --- */
        .garage-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem; height: 100%; overflow-y: auto; padding: 0.5rem 1rem 2rem 1rem;
            scrollbar-width: none;
        }
        .garage-grid::-webkit-scrollbar { display: none; }
        
        @media (min-width: 1200px) { .garage-grid { grid-template-columns: repeat(5, 1fr); } }

        .constructor-card {
            background: linear-gradient(145deg, rgba(30,30,30,0.8) 0%, rgba(10,10,10,0.95) 100%);
            border: 1px solid var(--glass-border);
            border-bottom: 4px solid var(--team-color, #444);
            border-radius: 12px; padding: 1.2rem;
            display: flex; flex-direction: column; position: relative;
            transform-style: preserve-3d; transition: transform 0.2s ease, box-shadow 0.3s ease;
            height: 100%; justify-content: space-between; min-height: 220px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .constructor-card:hover { 
            border-color: rgba(255,255,255,0.3);
            border-bottom-color: var(--team-color);
            box-shadow: 0 10px 40px var(--team-color, rgba(255,255,255,0.1)); 
            transform: translateY(-5px); z-index: 2;
        }
        
        .cc-bg-rank { position: absolute; top: -0.5rem; right: 0.5rem; font-size: 4rem; font-family: 'Rajdhani'; font-weight: 800; color: rgba(255,255,255,0.03); pointer-events: none; }
        .cc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; z-index: 2; transform: translateZ(30px); }
        .cc-name { font-family: 'Rajdhani'; font-weight: 700; font-size: 1rem; }
        .cc-points { color: var(--team-color); font-family: 'JetBrains Mono'; font-weight: 700; background: rgba(0,0,0,0.5); padding: 0.2rem 0.4rem; border-radius: 4px; border: 1px solid rgba(255,255,255,0.1); }
        .cc-img-container { flex-grow: 1; display: flex; align-items: center; justify-content: center; transform: translateZ(50px); height: 80px; margin-top: auto; margin-bottom: auto; }
        .cc-car-img { max-width: 100%; max-height: 100%; object-fit: contain; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5)); }

        /* --- DOTD (Accordion) --- */
        .dotd-accordion-container { width: 100%; height: 100%; display: flex; flex-direction: column; gap: 0; overflow: hidden; }
        @media (min-width: 768px) { .dotd-accordion-container { flex-direction: row; } }
        .dotd-panel {
            flex: 1; display: flex; position: relative; background-size: cover; background-position: center top;
            background-repeat: no-repeat; overflow: hidden; transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
            cursor: pointer; min-height: 60px; border: 1px solid rgba(255,255,255,0.05);
        }
        .dotd-panel::before {
            content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.9) 100%);
            z-index: 1; transition: background 0.5s;
        }
        .dotd-panel:hover { flex: 4; cursor: default; border-color: var(--team-color); }
        .dotd-panel:hover::before { background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.8) 100%); }
        .dotd-label {
            position: absolute; z-index: 2; top: 50%; left: 50%; transform: translate(-50%, -50%);
            white-space: nowrap; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1.2rem;
            text-transform: uppercase; color: rgba(255,255,255,0.7); transition: all 0.3s;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8); pointer-events: none;
        }
        @media (min-width: 768px) {
            .dotd-label { transform: translate(-50%, -50%) rotate(-90deg); font-size: 1.5rem; }
            .dotd-panel:hover .dotd-label { opacity: 0; transform: translate(-50%, -200%) rotate(-90deg); }
        }
        @media (max-width: 767px) {
            .dotd-panel:hover .dotd-label { opacity: 0; transform: translate(-200%, -50%); }
        }
        .dotd-content {
            position: absolute; bottom: 0; left: 0; width: 100%; padding: 1.5rem; z-index: 3;
            opacity: 0; transform: translateY(20px); transition: all 0.4s 0.1s ease-out;
            display: flex; flex-direction: column; justify-content: flex-end;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
        }
        .dotd-panel:hover .dotd-content { opacity: 1; transform: translateY(0); }
        .dotd-gp-name { color: var(--accent-cyan); font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; margin-bottom: 0.5rem; letter-spacing: 1px; }
        .dotd-driver-name { color: #fff; font-family: 'Rajdhani', sans-serif; font-size: 2rem; font-weight: 800; line-height: 1; text-transform: uppercase; margin-bottom: 0.5rem; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .dotd-team-name { color: var(--team-color); font-family: 'Rajdhani', sans-serif; font-size: 1rem; font-weight: 600; text-transform: uppercase; }
        .dotd-badge-icon {
            position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; color: #FFD700; opacity: 0;
            transform: scale(0); transition: all 0.3s 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 4; filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5));
        }
        .dotd-panel:hover .dotd-badge-icon { opacity: 1; transform: scale(1); }

        /* --- CALENDAR GRID (GLOSSY CARDS FIXED) --- */
        .cal-grid { 
            display: flex; flex-wrap: wrap; gap: 1.5rem; max-width: 1400px; margin-top: 2rem; 
            justify-content: center; 
        }
        .cal-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            padding: 1.5rem; text-align: center;
            transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            display: flex; flex-direction: column; justify-content: space-between;
            flex: 1 1 220px; max-width: 280px; min-height: 180px; 
            border-radius: 12px; position: relative; overflow: hidden;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .cal-item::before {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px;
            background: var(--accent-cyan); transform: scaleX(0); transition: transform 0.3s ease;
            transform-origin: left;
        }
        .cal-item:hover { 
            transform: translateY(-5px); border-color: rgba(255,255,255,0.4); 
            box-shadow: 0 10px 40px rgba(0, 240, 255, 0.15);
        }
        .cal-item:hover::before { transform: scaleX(1); }
        .cal-item.future-race { opacity: 0.7; }
        .cal-item.next-race { 
            opacity: 1; border: 1px solid var(--accent-cyan); 
            background: rgba(0, 240, 255, 0.05); box-shadow: 0 0 30px rgba(0, 240, 255, 0.1); 
        }
        .cal-item.next-race .gp { color: var(--accent-cyan); text-shadow: 0 0 10px var(--accent-cyan); }
        .round { font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--accent-red); display: block; margin-bottom: 0.5rem; letter-spacing: 0.1em; font-weight: 700; }
        .gp { font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1.4rem; color: #fff; line-height: 1.1; margin-bottom: 0.5rem; display: block; }
        .date { font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; color: #aaa; display: block; margin-bottom: 1rem; }
        
        .btn-ai-intel {
            margin-top: auto; padding: 0.6rem; background: rgba(255,255,255,0.05); 
            border: 1px solid var(--accent-cyan); color: var(--accent-cyan); font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem; cursor: pointer; pointer-events: auto; transition: all 0.2s;
            text-transform: uppercase; border-radius: 4px; display: flex; align-items: center; justify-content: center; gap: 8px;
            width: 100%; letter-spacing: 0.1em;
        }
        .btn-ai-intel:hover { background: var(--accent-cyan); color: #000; font-weight: 700; }

        /* --- ARCHIVE SECTION --- */
        .archive-controls { margin-bottom: 1rem; display: flex; gap: 10px; }
        .archive-loading { text-align: center; padding: 2rem; color: var(--accent-cyan); font-family: 'JetBrains Mono'; }
        .season-btn-group {
            display: flex; gap: 10px; justify-content: center; margin-bottom: 1rem; flex-wrap: wrap;
        }

        /* Sticky Headers for Archive - FIXED OVERLAP */
        .sticky-left { position: sticky; left: 0; z-index: 15; background: #050505; border-right: 1px solid rgba(255,255,255,0.1); }
        .sticky-top { position: sticky; top: 0; z-index: 20; background: #000; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sticky-corner { position: sticky; left: 0; top: 0; z-index: 30; background: #000; border-right: 1px solid rgba(255,255,255,0.1); border-bottom: 1px solid rgba(255,255,255,0.1); }

        /* --- SEASON AWARDS (BENTO GRID - COMPACT) --- */
        .awards-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* Fixed 4 columns for tighter packing on desktop */
            gap: 1rem; /* Smaller gap */
            padding: 1rem;
            grid-auto-flow: dense; 
            max-width: 1000px; /* Reduced max-width for more compact look */
            margin: 0 auto;
        }
        
        /* Fallback for smaller screens */
        @media (max-width: 1024px) { .awards-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .awards-grid { grid-template-columns: 1fr; } }
        
        .award-card {
            background: #111; border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px; overflow: hidden; position: relative;
            transition: transform 0.3s;
            display: flex; flex-direction: column;
            cursor: pointer;
            height: 180px; /* Fixed base height for cards */
        }
        .award-card:hover { transform: scale(1.03); border-color: var(--accent-cyan); z-index: 5; }
        
        .award-img { 
            width: 100%; height: 100%; object-fit: cover; 
            transition: opacity 0.3s; opacity: 0.7;
        }
        .award-card:hover .award-img { opacity: 1; }
        
        .award-info {
            position: absolute; bottom: 0; left: 0; width: 100%;
            padding: 0.8rem; 
            background: linear-gradient(to top, rgba(0,0,0,0.95), transparent);
            z-index: 2;
        }
        .award-title { color: var(--accent-cyan); font-family: 'Rajdhani'; font-weight: 700; text-transform: uppercase; font-size: 0.9rem; margin-bottom: 0.1rem; text-shadow: 0 2px 4px #000; }
        .award-winner { color: #fff; font-family: 'JetBrains Mono'; font-size: 0.8rem; font-weight: 700; text-shadow: 0 2px 4px #000; }
        
        /* Grid Spans for Bento Layout */
        .span-2-row { grid-row: span 2; height: 376px; } /* 180*2 + 16(gap) */
        .span-2-col { grid-column: span 2; }
        .span-2-both { grid-column: span 2; grid-row: span 2; height: 376px; }
        .span-full { grid-column: 1 / -1; }

        /* --- IMAGE MODAL (LIGHTBOX) --- */
        #img-modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 20000; display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: 0.3s;
        }
        #img-modal-overlay.active { opacity: 1; visibility: visible; }
        .img-modal-content {
            max-width: 90vh; max-height: 90vh;
            display: flex; flex-direction: column;
            position: relative; pointer-events: auto;
        }
        .img-modal-content img {
            max-width: 100%; max-height: 80vh;
            object-fit: contain;
            border: 2px solid var(--accent-cyan);
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.2);
            background: #000;
        }
        .img-modal-text {
            background: #000; padding: 1rem; text-align: center;
            border: 1px solid var(--accent-cyan); border-top: none;
            color: #fff;
        }
        .close-img-modal {
            position: absolute; top: -40px; right: 0;
            color: #fff; font-size: 2rem; cursor: pointer;
        }
        .close-img-modal:hover { color: var(--accent-cyan); }


        /* Other UI */
        .btn-tech {
            pointer-events: auto; display: inline-block; padding: 0.8rem 2.5rem;
            background: var(--accent-red); color: #fff; font-family: 'Rajdhani'; font-weight: 700;
            text-decoration: none; clip-path: polygon(0 0, 100% 0, 95% 100%, 5% 100%);
            transition: all 0.3s; border: none; font-size: 1rem;
        }
        .btn-tech:hover { background: #fff; color: var(--accent-red); box-shadow: 0 0 20px rgba(255,31,75,0.5); }
        
        /* Contact Grid */
        .contact-grid { display: flex; gap: 2rem; flex-wrap: wrap; margin-top: 2rem; }
        .contact-item {
            display: flex; align-items: center; gap: 1rem; padding: 1.5rem 2rem;
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            color: #fff; text-decoration: none; transition: all 0.3s ease; pointer-events: auto;
        }
        .contact-item:hover { background: #fff; color: #000; transform: translateY(-5px); }

        /* Modals */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); 
            backdrop-filter: blur(10px); z-index: 9990; display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; pointer-events: none; transition: all 0.3s ease;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; pointer-events: auto; }
        
        .intel-modal {
            width: 90%; max-width: 800px; background: #000; border: 1px solid var(--accent-cyan);
            padding: 2rem; position: relative; clip-path: polygon(0 0, 100% 0, 100% 90%, 95% 100%, 0 100%);
            display: flex; flex-direction: column;
        }
        .intel-title { color: var(--accent-cyan); font-family: 'Rajdhani', sans-serif; font-size: 2rem; margin-bottom: 1rem; text-transform: uppercase; }
        .intel-content-layout {
            display: grid; grid-template-columns: 3fr 2fr; gap: 2rem; flex-grow: 1; max-height: 55vh; overflow: hidden;
        }
        .intel-left-column, .intel-right-column { overflow-y: auto; padding-right: 10px; }
        .intel-map-container { flex-shrink: 0; width: 100%; height: 0; padding-bottom: 56.25%; position: relative; }
        .intel-map-container img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; filter: brightness(0.8) contrast(1.1); }
        .ai-briefing { font-family: 'JetBrains Mono', monospace; line-height: 1.6; color: #ccc; }
        .close-modal { cursor: pointer; font-size: 1.5rem; color: #fff; transition: color 0.2s; float: right; }
        .close-modal:hover { color: var(--accent-cyan); }
        .setup-display { margin-bottom: 1.5rem; border: 1px solid var(--accent-red); padding: 1rem; background: rgba(255, 31, 75, 0.05); }
        .setup-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; text-align: left; }
        .setup-table td { padding: 0.4rem 0.5rem; border-bottom: 1px dashed rgba(255,255,255,0.1); }
        .setup-table td:first-child { color: var(--accent-cyan); font-weight: 700; width: 50%; }
        .setup-table td:last-child { text-align: right; color: #fff; font-weight: 500; }

        @media (max-width: 768px) {
            .fixed-ui { padding: 1rem; }
            .top-nav { display: none; }
            .slide-title { font-size: 3rem; }
            .garage-grid { grid-template-columns: 1fr; }
            .intel-content-layout { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div id="cursor"></div><div id="cursor-follower"></div>

    <div id="loader">
        <div class="tech-font" style="letter-spacing: 0.3em; font-size: 1.5rem;">INITIALIZING RACE CONTROL</div>
        <div class="loader-bar"><div class="loader-progress" id="load-bar"></div></div>
    </div>

    <div class="fixed-ui">
        <img id="app-logo" src="https://raw.githubusercontent.com/HARISHWINNER/TTRL/ade50d630c482acbb96676fc69c2849a58494f7f/RESOURCES/image.png" alt="TTRL" class="logo hover-target">
        <div class="header-right">
            <div class="top-nav">
                <a href="#" class="nav-link active hover-target" data-slide="0">HOME</a>
                <a href="#" class="nav-link hover-target" data-slide="1">CALENDAR</a>
                <a href="#" class="nav-link hover-target" data-slide="2">STANDINGS</a>
                <a href="#" class="nav-link hover-target" data-slide="3">REGISTER</a>
                <a href="#" class="nav-link hover-target" data-slide="4">PADDOCK</a>
                <a href="#" class="nav-link hover-target" data-slide="5">ARCHIVES</a>
            </div>
            <div class="mono-font text-sm uppercase tracking-widest"><span style="color: var(--accent-cyan)">Season 1</span> <span style="color: #666">// Completed</span></div>
        </div>
    </div>

    <!-- INTEL MODAL -->
    <div class="modal-overlay" id="intel-modal-overlay">
        <div class="intel-modal">
            <div style="margin-bottom:1rem; overflow:hidden;">
                <span class="close-modal hover-target" onclick="closeIntel()">&times;</span>
                <span style="color:var(--accent-cyan); font-family:'Rajdhani'; font-weight:700;">TACTICAL BRIEFING</span>
            </div>
            <div class="intel-title" id="intel-title">GP NAME</div>
            <div class="intel-content-layout">
                <div class="intel-left-column">
                    <div class="intel-map-container"><img id="intel-map" src="" alt="Map"></div>
                    <div id="ai-briefing" class="ai-briefing" style="margin-top:1rem;"></div>
                </div>
                <div class="intel-right-column">
                    <div id="setup-display" class="setup-display mono-font"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- IMAGE EXPAND MODAL -->
    <div class="modal-overlay" id="img-modal-overlay" onclick="closeImgModal()">
        <div class="img-modal-content" onclick="event.stopPropagation()">
            <span class="close-img-modal" onclick="closeImgModal()">&times;</span>
            <img id="img-modal-src" src="" alt="Award Poster">
            <div class="img-modal-text">
                <h3 id="img-modal-title" style="color:var(--accent-cyan); font-family:'Rajdhani'; font-weight:800; text-transform:uppercase; margin:0;"></h3>
                <p id="img-modal-desc" style="color:#fff; font-family:'JetBrains Mono'; margin:0;"></p>
            </div>
        </div>
    </div>

    <div class="slides-wrapper">
        <!-- SLIDE 0: HERO -->
        <section class="slide active" id="slide-0">
            <div class="slide-bg" style="background-image: url('https://raw.githubusercontent.com/S-HARISH44/TTRL/a63c5b81b6a861f85d3efb76fe0c9bb2590de507/RESOURCES/f1-cars-race-track-3840x2160-13489.jpg'); opacity:0.8;"></div>

            <div class="slide-content home-design-container">
                <div class="home-title-group">
                    <div class="home-title-main">
                        <span class="text-fill">TURBO</span>
                        <span class="text-stroke">TRIBE</span>
                    </div>
                    <div class="home-title-sub">
                        <span class="text-stroke">RACING</span>
                        <span class="text-fill">LEAGUE</span>
                    </div>
                </div>

                <div class="home-countdown">
                    <div class="cd-box"><span class="cd-number" id="cd-days">00</span><span class="cd-label">DAYS</span></div>
                    <div class="cd-box"><span class="cd-number" id="cd-hours">00</span><span class="cd-label">HRS</span></div>
                    <div class="cd-box"><span class="cd-number" id="cd-mins">00</span><span class="cd-label">MIN</span></div>
                    <div class="cd-box"><span class="cd-number" id="cd-secs">00</span><span class="cd-label">SEC</span></div>
                </div>
                
                <div id="next-race-info" class="next-race-display">
                    SEASON COMPLETED // WAITING FOR SEASON 2
                </div>

                <div class="home-cards-container">
                    <div class="home-card hover-target" style="background-image: url('https://raw.githubusercontent.com/S-HARISH44/TTRL/e892dbee23fd4d1b55f5e04b6ba2bf00f54126e3/RESOURCES/card/button_2.png');">
                        <div class="hc-content">
                            <span class="hc-tag">SEASON 2</span>
                            <span class="hc-sub">YET TO ANNOUNCE</span>
                            <span class="hc-title">LEAGUE RACE</span>
                            <a href="https://docs.google.com/forms/d/e/1FAIpQLSc1xE8SkAOIKoHaryLjNgTNXJfmBCSv73vdgxaAA0_uxnmUTw/viewform" target="_blank" class="hc-btn hc-btn-red hover-target">JOIN NOW</a>
                        </div>
                    </div>

                    <div class="home-card hover-target" style="background-image: url('https://raw.githubusercontent.com/S-HARISH44/TTRL/e892dbee23fd4d1b55f5e04b6ba2bf00f54126e3/RESOURCES/card/button_4.png');">
                        <div class="hc-content">
                            <span class="hc-tag">SPECIAL EVENTS</span>
                            <span class="hc-title" style="margin-top:1.5rem;">SOCIAL RACE</span>
                            <a href="https://discord.com/channels/1345718934174957590/1345721726188912671" target="_blank" class="hc-btn hc-btn-grey hover-target">JOIN NOW</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SLIDE 1: CALENDAR -->
        <section class="slide" id="slide-1">
            <div class="slide-bg" style="background-image: url('https://raw.githubusercontent.com/S-HARISH44/TTRL/577532eaacf8de58ca32f2b9e5d0112cf71a3689/RESOURCES/Belgium.avif')"></div>
            <div class="slide-content">
                <div class="slide-tag">02 // GLOBAL TOUR</div>
                <h2 class="slide-title tech-font">RACE <span class="text-outline">CALENDAR</span></h2>
                <div id="calendar-grid" class="cal-grid mono-font"></div>
            </div>
        </section>

        <!-- SLIDE 2: STANDINGS -->
        <section class="slide" id="slide-2">
            <div class="slide-bg" style="background-image: url('https://f1chronicle.com/wp-content/uploads/2024/01/SI202412010400-1920x1080.jpg')"></div>
            <div class="slide-content">
                <div class="slide-tag">03 // LEADERBOARD</div>
                <h2 class="slide-title tech-font">TOP <span class="text-outline">PERFORMERS</span></h2>
                <div class="standings-tabs">
                    <button class="tab-btn active hover-target" data-tab="drivers">DRIVERS</button>
                    <button class="tab-btn hover-target" data-tab="constructors">TEAMS</button>
                </div>
                <div class="standings-wrapper">
                    <div class="standings-view active-view" id="view-drivers">
                         <div class="table-scroll">
                            <table class="standings-table">
                                <thead><tr><th>POS</th><th>DRIVER</th><th>TEAM</th><th>PTS</th></tr></thead>
                                <tbody id="drivers-body"><tr><td colspan="4" class="archive-loading">CONNECTING TO DATABASE...</td></tr></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="standings-view" id="view-constructors">
                        <div class="garage-grid" id="garage-grid">
                            <div class="archive-loading">CALCULATING POINTS...</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SLIDE 3: REGISTER -->
        <section class="slide" id="slide-3">
            <div class="slide-bg" style="background-image: url('https://raw.githubusercontent.com/S-HARISH44/TTRL/577532eaacf8de58ca32f2b9e5d0112cf71a3689/RESOURCES/1-w-GettyImages-2048270135.webp')"></div>
            <div class="slide-content">
                <div class="slide-tag">04 // ENLIST</div>
                <h2 class="slide-title tech-font">JOIN <span class="text-outline">THE GRID</span></h2>
                <div class="btn-container"><a href="https://docs.google.com/forms/d/e/1FAIpQLSc1xE8SkAOIKoHaryLjNgTNXJfmBCSv73vdgxaAA0_uxnmUTw/viewform" target="_blank" class="btn-tech hover-target">REGISTER NOW</a></div>
            </div>
        </section>

         <!-- SLIDE 4: PADDOCK -->
        <section class="slide" id="slide-4">
            <div class="slide-bg" id="vanta-bg"></div>
            <div class="slide-content">
                <div class="slide-tag">05 // PADDOCK</div>
                <h2 class="slide-title tech-font">CONNECT <span class="text-outline">WITH US</span></h2>
                <div class="contact-grid mono-font">
                    <a href="https://discord.gg/EuyPTXqbg6" target="_blank" class="contact-item hover-target"><i class="fa-brands fa-discord"></i> <span>DISCORD</span></a>
                    <a href="https://www.youtube.com/@TurboTribeRacingLeague" target="_blank" class="contact-item hover-target"><i class="fa-brands fa-youtube"></i> <span>YOUTUBE</span></a>
                    <a href="mailto:turbotriberacingleague@gmail.com" class="contact-item hover-target"><i class="fa-solid fa-envelope"></i> <span>EMAIL</span></a>
                </div>
            </div>
        </section>

        <!-- SLIDE 5: ARCHIVES -->
        <section class="slide" id="slide-5">
            <div class="slide-bg" style="background-image: url('https://raw.githubusercontent.com/S-HARISH44/TTRL/a63c5b81b6a861f85d3efb76fe0c9bb2590de507/RESOURCES/001-EA-Sports-F1-2023-Video-Game-Review.jpg'); filter: brightness(0.2);"></div>
            <div class="slide-content">
                <div class="slide-tag">06 // DATA VAULT</div>
                <h2 class="slide-title tech-font">SEASON <span class="text-outline">ARCHIVES</span></h2>
                
                <div class="archive-controls">
                    <div class="season-btn-group">
                        <button class="tab-btn active" onclick="setSeason('season_1')">SEASON 1</button>
                        <button class="tab-btn" onclick="setSeason('season_2')">SEASON 2</button>
                    </div>
                </div>

                <!-- UPDATED TABS -->
                <div class="standings-tabs" style="justify-content: center;">
                    <button class="tab-btn active hover-target" data-tab="archive-drivers">DRIVERS</button>
                    <button class="tab-btn hover-target" data-tab="archive-teams">TEAMS</button>
                    <button class="tab-btn hover-target" data-tab="archive-dotd">DOTD</button>
                    <button class="tab-btn hover-target" data-tab="archive-season-awards">SEASON AWARDS</button>
                </div>

                <div class="standings-wrapper" style="height: 55vh;">
                    <!-- DRIVER ARCHIVE -->
                    <div class="standings-view active-view" id="view-archive-drivers">
                        <div class="table-scroll" id="archives-drivers-container">
                             <div class="archive-loading">LOADING DRIVER MATRIX...</div>
                        </div>
                    </div>

                    <!-- TEAM ARCHIVE -->
                    <div class="standings-view" id="view-archive-teams">
                        <div class="table-scroll" id="archives-teams-container">
                             <div class="archive-loading">LOADING TEAM MATRIX...</div>
                        </div>
                    </div>

                    <!-- DOTD ARCHIVE -->
                    <div class="standings-view" id="view-archive-dotd">
                        <div class="dotd-accordion-container" id="dotd-container"></div>
                    </div>

                    <!-- NEW: SEASON AWARDS ARCHIVE (BENTO GRID) -->
                    <div class="standings-view" id="view-archive-season-awards">
                        <div class="table-scroll">
                            <div class="awards-grid" id="season-awards-grid"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanta/0.5.24/vanta.net.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyApUD33ao9DfFa8IAfA2qby3IFKhLtcNFU",
            authDomain: "ttrl-9f3ef.firebaseapp.com",
            projectId: "ttrl-9f3ef",
            storageBucket: "ttrl-9f3ef.firebasestorage.app",
            messagingSenderId: "51144639440",
            appId: "1:51144639440:web:8a027b773bc2cddefe2fd5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // CONSTANTS
        const TEAMS = [
            {id:'red-bull-racing', name:'Red Bull'}, {id:'ferrari', name:'Ferrari'}, {id:'mercedes', name:'Mercedes'},
            {id:'mclaren', name:'McLaren'}, {id:'aston-martin', name:'Aston Martin'}, {id:'alpine', name:'Alpine'},
            {id:'williams', name:'Williams'}, {id:'racing-bulls', name:'Racing Bulls'}, {id:'kick-sauber', name:'Kick Sauber'},
            {id:'haas', name:'Haas'}, {id:'reserve', name:'Reserve'}
        ];
        
        // Static Metadata for Tracks (Images, Insights) - Dates come from Firestore
        const TRACK_METADATA = {
            'bahrain': { gp: "Bahrain Grand Prix", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Bahrain-circuit-768x432.png", insight: "Stop and go track." },
            'australia': { gp: "Australian Grand Prix", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Albert-Park-Circuit-768x432.png", insight: "Fast flowing street circuit." },
            'imola': { gp: "Emilia Romagna GP", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Autodromo-Enzo-e-Dino-Ferrari-768x432.png", insight: "Narrow and technical." },
            'spain': { gp: "Spanish Grand Prix", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2024/02/Circuit-de-Barcelona-768x432.png", insight: "Test of aerodynamics." },
            'uk': { gp: "British Grand Prix", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Silverstone-Circuit--768x432.png", insight: "High speed corners." },
            'vegas': { gp: "Las Vegas Grand Prix", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2024/02/Las-Vegas-GP-768x432.png", insight: "High speed street fight." },
            'belgium': { gp: "Belgian Grand Prix", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Circuit-de-Spa-Francorchamps-768x432.png", insight: "Longest track on calendar." },
            'austria': { gp: "Austrian Grand Prix", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Red-Bull-Ring-768x432.png", insight: "Short power lap." },
            'brazil': { gp: "SÃ£o Paulo Grand Prix", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Auto%CC%81dromo-Jose%CC%81-Carlos-Pace--768x432.png", insight: "Classic anti-clockwise track." },
            'abu_dhabi': { gp: "Abu Dhabi Grand Prix", mapUrl: "https://www.sportmonks.com/wp-content/uploads/2022/07/Yas-Marina-Circuit--768x432.png", insight: "Season finale." },
            'saudi_arabia': { gp: "Saudi Arabian GP", mapUrl: "https://placehold.co/768x432?text=Jeddah", insight: "Fastest street circuit." },
            'japan': { gp: "Japanese GP", mapUrl: "https://placehold.co/768x432?text=Suzuka", insight: "Figure 8 layout." },
            'china': { gp: "Chinese GP", mapUrl: "https://placehold.co/768x432?text=Shanghai", insight: "Technical sectors." },
            'miami': { gp: "Miami GP", mapUrl: "https://placehold.co/768x432?text=Miami", insight: "Technical street circuit." },
            'emilia_romagna': { gp: "Emilia Romagna GP", mapUrl: "https://placehold.co/768x432?text=Imola", insight: "History and speed." },
            'monaco': { gp: "Monaco GP", mapUrl: "https://placehold.co/768x432?text=Monaco", insight: "The jewel in the crown." },
            'canada': { gp: "Canadian GP", mapUrl: "https://placehold.co/768x432?text=Montreal", insight: "Wall of champions." },
            'hungary': { gp: "Hungarian GP", mapUrl: "https://placehold.co/768x432?text=Hungaroring", insight: "Monaco without walls." },
            'netherlands': { gp: "Dutch GP", mapUrl: "https://placehold.co/768x432?text=Zandvoort", insight: "Banked corners." },
            'italy': { gp: "Italian GP", mapUrl: "https://placehold.co/768x432?text=Monza", insight: "Temple of Speed." },
            'azerbaijan': { gp: "Azerbaijan GP", mapUrl: "https://placehold.co/768x432?text=Baku", insight: "Castle section." },
            'singapore': { gp: "Singapore GP", mapUrl: "https://placehold.co/768x432?text=Marina+Bay", insight: "Night race endurance." },
            'usa': { gp: "United States GP", mapUrl: "https://placehold.co/768x432?text=COTA", insight: "Elevation changes." },
            'mexico': { gp: "Mexico City GP", mapUrl: "https://placehold.co/768x432?text=Mexico", insight: "High altitude." },
            'las_vegas': { gp: "Las Vegas GP", mapUrl: "https://placehold.co/768x432?text=Vegas", insight: "The strip." },
            'qatar': { gp: "Qatar GP", mapUrl: "https://placehold.co/768x432?text=Lusail", insight: "Fast flowing." }
        };

        const TEAM_COLORS = {
            "red-bull-racing": "#3671C6", "ferrari": "#E80020", "mercedes": "#27F4D2", "mclaren": "#FF8000",
            "aston-martin": "#229971", "alpine": "#0093CC", "williams": "#64C4FF", "racing-bulls": "#6692FF",
            "kick-sauber": "#52E252", "haas": "#B6BABD", "reserve": "#666666"
        };
        const CAR_IMAGES = {
            "red-bull-racing": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025redbullracingcarright.png",
            "ferrari": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025ferraricarright.png",
            "mercedes": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025mercedescarright.png",
            "mclaren": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025mclarencarright.png",
            "aston-martin": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025astonmartincarright.png",
            "alpine": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025alpinecarright.png",
            "williams": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025williamscarright.png",
            "racing-bulls": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025racingbullscarright.png",
            "kick-sauber": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025kicksaubercarright.png",
            "haas": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025haasf1teamcarright.png"
        };

        const DOTD_DATA = [
            { gp: "Bahrain Grand Prix", driver: "Sanju Vibhi", team: "ASTON MARTIN", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Sanju.png", desc: "Voted Driver of the Day for a stellar performance." },
            { gp: "Australian Grand Prix", driver: "Apex Entropy", team: "KICK SAUBER", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Apex%201.png", desc: "Exceptional pace down under at Albert Park." },
            { gp: "Emilia Romagna GP", driver: "Mahesh", team: "WILLIAMS", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Mahesh.png", desc: "A fan-favorite drive at Imola's historic circuit." },
            { gp: "Spanish Grand Prix", driver: "Apex Entropy", team: "ALPINE", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Apex.png", desc: "Superb driving at Catalunya earned the fans' vote." },
            { gp: "Great Britain GP", driver: "Sanju Vibhi", team: "ASTON MARTIN", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Sanju%201.png", desc: "A standout performance at Silverstone." },
            { gp: "Las Vegas Grand Prix", driver: "Harish", team: "HAAS", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Harish.png", desc: "Electrifying drive on the Vegas Strip." },
            { gp: "Belgian Grand Prix", driver: "Sandeep Mareedu", team: "RACING BULLS", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Sandeep.png", desc: "Incredible drive as a reserve for Racing Bulls." },
            { gp: "Austrian Grand Prix", driver: "Wi7ard", team: "WILLIAMS", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Wizard.png", desc: "Magical performance at the Red Bull Ring." },
            { gp: "SÃ£o Paulo Grand Prix", driver: "TheGodfather", team: "ALPINE", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Godfather.png", desc: "An offer Interlagos couldn't refuse." },
            { gp: "Abu Dhabi Grand Prix", driver: "Wi7ard", team: "WILLIAMS", image: "https://github.com/S-HARISH44/TTRL/blob/ef6d28c8baa4a8e9c15f64a76f854e80a95fadbc/RESOURCES/DOTD/Lime_Green_and_Black_Dynamic_Match_Instagram_Post_4.png?raw=true", desc: "Dominant performance to end the season." }
        ];
        
        // REORDERED AWARDS: Champions First
        const SEASON_AWARDS = [
            { title: "Driver Champion", winner: "Wi7ard", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/winner.png" },
            { title: "Driver of the Season", winner: "Simman", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/season%20driver.png" },
            { title: "Team Champions", winner: "Williams", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/team%20winner.png" },
            { title: "Team of the Season", winner: "Alpine", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/2nd%20runner.png" },
            { title: "Cleanest Driver", winner: "The Godfather", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/cleanest%20driver.png" },
            { title: "The Super Sub", winner: "Sandeep", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/the%20super%20sub.png" },
            { title: "Rain Master", winner: "Harish", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/rain%20master.png" },
            { title: "The Underdog", winner: "Kentucky", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/underdog%20(1).png" },
            { title: "Most Consistent Driver", winner: "Apex Entropy", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/consistent%20driver.png" },
            { title: "Emerging Driver", winner: "Vibin", img: "https://raw.githubusercontent.com/S-HARISH44/TTRL/907c39d6dbfaf2ff3e019a34d213152d20a4859b/RESOURCES/Awards/emerging%20driver.png" }
        ];

        const f125SetupData = {
            "Australian Grand Prix": { aero: "13-9 (Q) / 9-3 (R)", differential: "100 (On) - 20 (Off)", suspGeometry: "LLLL", suspension: "41-3-7-16-21-40", brakes: "100% / 54%", tiresQ: "27.0 PSI / 23.5 PSI", tiresR: "27.5 PSI / 23.5 PSI", notes: "High deg." },
            "Bahrain Grand Prix": { aero: "20-15", differential: "80 (On) - 50 (Off)", suspGeometry: "RLRL", suspension: "5-3-9-3-20-40", brakes: "100% / 50%", tiresQ: "23.2 PSI / 21.0 PSI", tiresR: "21.2 PSI / 19.0 PSI", notes: "Rear traction focus." },
            "Emilia Romagna Grand Prix": { aero: "35-30", differential: "50 (On) - 50 (Off)", suspGeometry: "LLLR", suspension: "7-8-3-1-30-40", brakes: "100% / 52%", tiresQ: "24.0 PSI / 21.5 PSI", tiresR: "22.0 PSI / 20.0 PSI", notes: "High downforce." },
            "Spanish Grand Prix": { aero: "38-30", differential: "60 (On) - 55 (Off)", suspGeometry: "RRRR", suspension: "3-8-4-1-20-40", brakes: "100% / 55%", tiresQ: "24.2 PSI / 21.8 PSI", tiresR: "22.2 PSI / 20.8 PSI", notes: "Turn 3 kills tires." },
            "Great Britain Grand Prix": { aero: "20-15", differential: "90 (On) - 60 (Off)", suspGeometry: "LLRL", suspension: "10-1-5-1-15-30", brakes: "100% / 53%", tiresQ: "23.5 PSI / 21.0 PSI", tiresR: "21.5 PSI / 19.5 PSI", notes: "Aerodynamic efficiency." },
            "Las Vegas Grand Prix": { aero: "10-5", differential: "100 (On) - 20 (Off)", suspGeometry: "LLLL", suspension: "1-1-1-1-30-40", brakes: "100% / 50%", tiresQ: "23.0 PSI / 21.0 PSI", tiresR: "21.0 PSI / 19.0 PSI", notes: "Min drag." },
            "Belgian Grand Prix": { aero: "15-10", differential: "90 (On) - 60 (Off)", suspGeometry: "RRRL", suspension: "1-1-1-1-25-30", brakes: "100% / 50%", tiresQ: "22.8 PSI / 20.8 PSI", tiresR: "20.8 PSI / 18.8 PSI", notes: "Low drag." },
            "Austrian Grand Prix": { aero: "20-15", differential: "95 (On) - 65 (Off)", suspGeometry: "LLLR", suspension: "5-1-4-1-20-30", brakes: "100% / 54%", tiresQ: "23.0 PSI / 21.0 PSI", tiresR: "21.0 PSI / 19.0 PSI", notes: "Traction out of slow corners." },
            "SÃ£o Paulo Grand Prix": { aero: "30-25", differential: "50 (On) - 50 (Off)", suspGeometry: "RRRR", suspension: "7-8-3-1-25-40", brakes: "100% / 52%", tiresQ: "24.0 PSI / 21.5 PSI", tiresR: "22.0 PSI / 20.0 PSI", notes: "Rotation needed." },
            "Abu Dhabi Grand Prix": { aero: "25-20", differential: "70 (On) - 55 (Off)", suspGeometry: "LLRL", suspension: "3-5-2-1-20-40", brakes: "100% / 53%", tiresQ: "23.8 PSI / 21.3 PSI", tiresR: "21.8 PSI / 19.8 PSI", notes: "Technical S3." }
        };

        let allDrivers = [];
        let activeTracks = []; // Loaded from Firebase
        let currentSeason = 'season_1';
        let unsubscribe = null;

        const intelModal = document.getElementById('intel-modal-overlay');
        const intelTitle = document.getElementById('intel-title');
        const intelMap = document.getElementById('intel-map');
        const setupDisplay = document.getElementById('setup-display');
        const aiBriefing = document.getElementById('ai-briefing');

        function closeIntel() { intelModal.classList.remove('active'); }
        window.closeIntel = closeIntel; // EXPOSE FOR HTML
        
        // --- NEW: Image Modal Functions ---
        function closeImgModal() {
            const modal = document.getElementById('img-modal-overlay');
            modal.classList.remove('active');
            setTimeout(() => {
                 document.getElementById('img-modal-src').src = "";
            }, 300);
        }
        window.closeImgModal = closeImgModal;

        window.openImageModal = (src, title, winner) => {
            const modal = document.getElementById('img-modal-overlay');
            const img = document.getElementById('img-modal-src');
            const t = document.getElementById('img-modal-title');
            const d = document.getElementById('img-modal-desc');
            
            img.src = src;
            t.innerText = title;
            d.innerText = `WINNER: ${winner}`;
            
            modal.classList.add('active');
        }

        function displaySetupData(setup) {
            if (!setup) {
                setupDisplay.innerHTML = "<h4>Baseline Setup Prediction</h4><p>No specific data available.</p>";
                return;
            }
            setupDisplay.innerHTML = `
                <h4>F1 25 Baseline Setup</h4>
                <table class="setup-table">
                    <tr><td>Aero (F/R)</td><td>${setup.aero}</td></tr>
                    <tr><td>Differential</td><td>${setup.differential}</td></tr>
                    <tr><td>Suspension</td><td>${setup.suspension}</td></tr>
                    <tr><td>Brakes</td><td>${setup.brakes}</td></tr>
                    <tr><td>Tires (Q/R)</td><td>${setup.tiresQ} / ${setup.tiresR}</td></tr>
                </table>
            `;
        }

        async function fetchTrackIntel(trackId) {
            // trackId passed from button is now the stable ID (e.g. 'bahrain')
            intelModal.classList.add('active');
            requestAnimationFrame(async () => {
                const meta = TRACK_METADATA[trackId] || { gp: trackId.toUpperCase(), mapUrl: 'https://placehold.co/768x432/111111/FFFFFF?text=MAP+NOT+FOUND', insight: "No data." };
                const gpName = meta.gp;
                
                // Fallback for setup data matching
                const setupKey = Object.keys(f125SetupData).find(k => k.toLowerCase().includes(gpName.toLowerCase()) || gpName.toLowerCase().includes(k.toLowerCase()));
                const setup = f125SetupData[setupKey];
                
                intelTitle.innerText = gpName.toUpperCase();
                intelMap.src = meta.mapUrl;
                displaySetupData(setup);
                
                aiBriefing.innerHTML = `
                    <div style="color: #fff; font-family: 'Rajdhani'; font-weight: bold; margin-bottom: 5px;">TRACK INSIGHT</div>
                    <div style="color: #ccc; font-size: 0.9rem;">${meta.insight}</div>
                `;
            });
        }
        window.fetchTrackIntel = fetchTrackIntel; // EXPOSE FOR HTML

        // --- FIREBASE LOGIC ---
        async function loadSeasonData(seasonId) {
            currentSeason = seasonId || "season_1";
            
            // 1. Fetch Track Config First
            const seasonDoc = await getDoc(doc(db, "seasons", currentSeason));
            if (seasonDoc.exists() && seasonDoc.data().trackConfig) {
                activeTracks = seasonDoc.data().trackConfig;
                activeTracks.sort((a, b) => new Date(a.date || '9999-12-31') - new Date(b.date || '9999-12-31'));
            } else {
                activeTracks = [];
            }

            // 2. Fetch Drivers & Render
            if(unsubscribe) unsubscribe();
            const q = query(collection(db, "seasons", currentSeason, "drivers"), orderBy("totalPoints", "desc"));
            
            unsubscribe = onSnapshot(q, (snapshot) => {
                allDrivers = [];
                snapshot.forEach(doc => allDrivers.push(doc.data()));
                
                // Update views
                if(!seasonId) { // Main View (Season 1)
                    renderCalendar();
                    renderDrivers();
                    renderConstructors();
                    updateCountdown();
                }
                
                // Always update archives
                renderArchiveDrivers();
                renderArchiveTeams();
            });
        }

        window.setSeason = (sid) => {
            // Update button styles
            document.querySelectorAll('.season-btn-group .tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.innerText.toLowerCase().replace(' ', '_') === sid) btn.classList.add('active');
            });
            loadSeasonData(sid);
        };

        // 1. DRIVER STANDINGS (Main)
        function renderDrivers() {
            const tbody = document.getElementById("drivers-body");
            tbody.innerHTML = "";
            
            const sortedDrivers = [...allDrivers].sort((a, b) => {
                if (a.team === 'reserve' && b.team !== 'reserve') return 1;
                if (a.team !== 'reserve' && b.team === 'reserve') return -1;
                return b.totalPoints - a.totalPoints;
            });

            sortedDrivers.forEach((d, i) => {
                const color = TEAM_COLORS[d.team] || '#fff';
                let teamName = TEAMS.find(t => t.id === d.team)?.name || d.team;
                
                if(d.team === 'reserve') {
                    const subTeams = new Set();
                    if(d.results) Object.values(d.results).forEach(r => {
                        if(typeof r === 'object' && r.team && r.team !== 'reserve') subTeams.add(TEAMS.find(t => t.id === r.team)?.name);
                    });
                    if(subTeams.size > 0) teamName += ` (${Array.from(subTeams).join(', ')})`;
                }

                tbody.innerHTML += `<tr style="--team-color: ${color}">
                    <td style="color:${i<3?['#FFD700','#C0C0C0','#CD7F32'][i]:'inherit'}">${String(i+1).padStart(2,'0')}</td>
                    <td style="font-weight:700">${d.name}</td>
                    <td style="text-transform:uppercase; font-size:0.8rem; letter-spacing:1px; opacity:0.8">${teamName}</td>
                    <td style="color:var(--accent-cyan); font-weight:700">${d.totalPoints}</td>
                </tr>`;
            });
        }

        // 2. CONSTRUCTOR STANDINGS (Main)
        function renderConstructors() {
            const teamPoints = {};
            TEAMS.forEach(t => { if(t.id !== 'reserve') teamPoints[t.id] = 0; });

            allDrivers.forEach(d => {
                const results = d.results || {};
                Object.values(results).forEach(r => {
                    let pts = 0;
                    let teamId = d.team;
                    if (typeof r === 'object') {
                        pts = Number(r.points || 0);
                        teamId = r.team || d.team;
                    } else {
                        pts = Number(r || 0);
                    }
                    if (teamId !== 'reserve' && teamPoints[teamId] !== undefined) {
                        teamPoints[teamId] += pts;
                    }
                });
            });

            const sortedTeams = Object.keys(teamPoints)
                .map(id => ({ id, name: TEAMS.find(t=>t.id===id).name, points: teamPoints[id] }))
                .sort((a,b) => b.points - a.points);

            document.getElementById('garage-grid').innerHTML = sortedTeams.map((c, i) => {
                const color = TEAM_COLORS[c.id];
                return `<div class="constructor-card hover-target" style="--team-color: ${color}">
                    <div class="cc-bg-rank">${String(i+1).padStart(2,'0')}</div>
                    <div class="cc-header"><span class="cc-name">${c.name}</span><span class="cc-points">${c.points} PTS</span></div>
                    <div class="cc-img-container"><img src="${CAR_IMAGES[c.id] || 'https://placehold.co/300x100?text=Car'}" class="cc-car-img"></div>
                </div>`;
            }).join('');
            
            if (!window.matchMedia("(pointer: coarse)").matches) {
                document.querySelectorAll('.constructor-card').forEach(card => {
                    card.addEventListener('mousemove', (e) => {
                        const rect = card.getBoundingClientRect();
                        const x = e.clientX - rect.left - rect.width/2;
                        const y = e.clientY - rect.top - rect.height/2;
                        gsap.to(card, { transform: `perspective(1000px) rotateX(${-y/10}deg) rotateY(${x/10}deg) scale3d(1.02, 1.02, 1.02)`, duration: 0.1 });
                    });
                    card.addEventListener('mouseleave', () => { gsap.to(card, { transform: `perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)`, duration: 0.5 }); });
                });
            }
        }

        // 3. ARCHIVE DRIVERS (Matrix)
        function renderArchiveDrivers() {
            const container = document.getElementById("archives-drivers-container");
            
            if(activeTracks.length === 0) {
                container.innerHTML = `<div class="archive-loading">NO TRACK DATA FOR THIS SEASON</div>`;
                return;
            }

            let html = `<table class="standings-table">`;
            html += `<thead><tr><th class="sticky-corner">DRIVER</th>`;
            // Dynamic Columns based on Fetched Tracks
            activeTracks.forEach(t => {
                // Shorten name: "Bahrain Grand Prix" -> "BAH" (rough heuristic or first 3 chars of ID)
                const label = t.id.substring(0, 3).toUpperCase(); 
                html += `<th class="sticky-top" style="text-align:center">${label}</th>`;
            });
            html += `<th class="sticky-top" style="text-align:center">TOTAL</th></tr></thead><tbody>`;

            const sortedDrivers = [...allDrivers].sort((a, b) => b.totalPoints - a.totalPoints);

            sortedDrivers.forEach(d => {
                const results = d.results || {};
                const tColor = TEAM_COLORS[d.team] || '#fff';
                
                html += `<tr style="--team-color: ${tColor}">`;
                html += `<td class="sticky-left" style="font-weight:700; background:var(--glass-bg); border-left:3px solid ${tColor}">${d.name}</td>`;
                
                let rowTotal = 0;
                activeTracks.forEach(t => {
                    let pts = '-';
                    if (results[t.id]) {
                        const val = typeof results[t.id] === 'object' ? results[t.id].points : results[t.id];
                        if (val > 0) { pts = val; } // Don't add to total here as we use stored total, but good for verify
                    }
                    html += `<td style="text-align:center; opacity:${pts === '-' ? 0.3 : 1}">${pts}</td>`;
                });
                
                html += `<td style="text-align:center; color:var(--accent-cyan); font-weight:700">${d.totalPoints}</td></tr>`;
            });
            html += `</tbody></table>`;
            container.innerHTML = html;
        }

        // 4. ARCHIVE TEAMS (Matrix)
        function renderArchiveTeams() {
            const container = document.getElementById("archives-teams-container");
            
            if(activeTracks.length === 0) {
                container.innerHTML = `<div class="archive-loading">NO TRACK DATA</div>`;
                return;
            }

            const teamTrackPoints = {};
            TEAMS.forEach(t => {
                if (t.id === 'reserve') return;
                teamTrackPoints[t.id] = { total: 0 };
                activeTracks.forEach(tr => teamTrackPoints[t.id][tr.id] = 0);
            });

            allDrivers.forEach(d => {
                const results = d.results || {};
                Object.keys(results).forEach(trackKey => {
                    // Only count if track exists in current config
                    if(!activeTracks.some(at => at.id === trackKey)) return;
                    
                    const r = results[trackKey];
                    let pts = 0, teamId = d.team;

                    if (typeof r === 'object') { pts = Number(r.points || 0); teamId = r.team || d.team; }
                    else { pts = Number(r || 0); }

                    if(teamId !== 'reserve' && teamTrackPoints[teamId]) {
                        teamTrackPoints[teamId][trackKey] += pts;
                        teamTrackPoints[teamId].total += pts;
                    }
                });
            });

            const sortedTeamIds = Object.keys(teamTrackPoints).sort((a,b) => teamTrackPoints[b].total - teamTrackPoints[a].total);

            let html = `<table class="standings-table">`;
            html += `<thead><tr><th class="sticky-corner">TEAM</th>`;
            activeTracks.forEach(t => {
                const label = t.id.substring(0, 3).toUpperCase();
                html += `<th class="sticky-top" style="text-align:center">${label}</th>`
            });
            html += `<th class="sticky-top" style="text-align:center">TOTAL</th></tr></thead><tbody>`;

            sortedTeamIds.forEach(tId => {
                const tColor = TEAM_COLORS[tId];
                const tName = TEAMS.find(t => t.id === tId)?.name;
                
                html += `<tr style="--team-color: ${tColor}">`;
                html += `<td class="sticky-left" style="font-weight:700; background:var(--glass-bg); border-left:3px solid ${tColor}; text-transform:uppercase;">${tName}</td>`;
                
                activeTracks.forEach(t => {
                    const pts = teamTrackPoints[tId][t.id];
                    html += `<td style="text-align:center; opacity:${pts === 0 ? 0.3 : 1}">${pts > 0 ? pts : '-'}</td>`;
                });
                html += `<td style="text-align:center; color:var(--accent-cyan); font-weight:700">${teamTrackPoints[tId].total}</td></tr>`;
            });
            html += `</tbody></table>`;
            container.innerHTML = html;
        }

        // --- CALENDAR & DOTD RENDERERS ---
        function renderCalendar() {
            // Dynamic calendar from fetched activeTracks
            const grid = document.getElementById('calendar-grid');
            if(activeTracks.length === 0) {
                grid.innerHTML = `<div style="text-align:center; width:100%; color:#666;">SEASON CALENDAR NOT CONFIGURED</div>`;
                return;
            }

            grid.innerHTML = activeTracks.map((r, i) => {
                // Merge static metadata with dynamic date
                const meta = TRACK_METADATA[r.id] || { gp: r.name, insight: "Global Tour" };
                const displayGP = meta.gp.replace(' Grand Prix', '').replace(' GP', '').toUpperCase();
                
                // Format Date if exists
                let dateDisplay = "TBD";
                if(r.date) {
                    const d = new Date(r.date);
                    dateDisplay = `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getFullYear()).slice(-2)}`;
                }

                return `<div class="cal-item hover-target">
                    <span class="round">RD ${String(i+1).padStart(2,'0')}</span>
                    <span class="gp">${displayGP}</span>
                    <span class="date">${dateDisplay}</span>
                    <button class="btn-ai-intel hover-target" onclick="fetchTrackIntel('${r.id}')"><i class="fa-solid fa-wand-magic-sparkles"></i> STRATEGY</button>
                </div>`;
            }).join('');
        }

        function renderDOTD() {
            document.getElementById('dotd-container').innerHTML = DOTD_DATA.map(d => {
                const tColor = TEAM_COLORS[d.team.toUpperCase().replace(' ', '-').toLowerCase()] || '#fff';
                return `<div class="dotd-panel" style="background-image: url('${d.image}'); --team-color: ${tColor}">
                    <div class="dotd-label">${d.driver.split(' ')[0]}</div>
                    <div class="dotd-badge-icon"><i class="fa-solid fa-award"></i></div>
                    <div class="dotd-content">
                        <div class="dotd-gp-name">${d.gp}</div>
                        <div class="dotd-driver-name">${d.driver}</div>
                        <div class="dotd-team-name" style="color:${tColor}">${d.team}</div>
                        <div class="mono-font" style="font-size:0.8rem; color:#ccc; margin-top:0.5rem;">${d.desc}</div>
                    </div>
                </div>`;
            }).join('');
        }

        // --- NEW: SEASON 1 AWARDS RENDERER ---
        function renderSeasonAwards() {
            const gridConfig = [
                "span-2-both", "span-2-col", "span-2-row", "", "", "span-2-col", "", "", "span-2-col", "span-full"
            ];

            document.getElementById('season-awards-grid').innerHTML = SEASON_AWARDS.map((a, index) => {
                let cardClass = gridConfig[index] || "";
                return `
                    <div class="award-card hover-target ${cardClass}" onclick="openImageModal('${a.img}', '${a.title}', '${a.winner}')">
                        <img src="${a.img}" class="award-img" alt="${a.title}">
                        <div class="award-info">
                            <div class="award-title">${a.title}</div>
                            <div class="award-winner">${a.winner}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // --- ANIMATIONS ---
        const slides = document.querySelectorAll('.slide');
        let currentIndex = 0;
        let isAnimating = false;

        function gotoSlide(index) {
            if (isAnimating || index === currentIndex) return;
            isAnimating = true;
            let nextIndex = index;
            const currentSlide = slides[currentIndex];
            const nextSlide = slides[nextIndex];
            
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.querySelectorAll('.nav-link')[index].classList.add('active');

            gsap.set(nextSlide, { zIndex: 20, visibility: 'visible', opacity: 0 });
            const tl = gsap.timeline({
                defaults: { ease: "power2.inOut", duration: 1.2 },
                onComplete: () => {
                    gsap.set(currentSlide, { visibility: 'hidden', zIndex: 1, opacity: 0 });
                    currentIndex = nextIndex;
                    isAnimating = false;
                }
            });
            tl.to(currentSlide, { scale: 0.9, opacity: 0, filter: 'brightness(0.5)' }, 0);
            tl.fromTo(nextSlide, { scale: 1.1, opacity: 0, filter: 'brightness(1.5)' }, { scale: 1, opacity: 1, filter: 'brightness(1)' }, "-=0.8");
            
            // Stagger animation for new home elements
            const elements = nextSlide.querySelectorAll('.slide-tag, .slide-title, .hero-main-title, .btn-container, .cal-item, .standings-wrapper, .contact-grid, .glass-stat-card, .home-title-group, .home-countdown, .home-card, .next-race-display');
            gsap.fromTo(elements, { y: 50, opacity: 0 }, { y: 0, opacity: 1, duration: 0.8, stagger: 0.1, delay: 0.5 });
        }

        document.querySelectorAll('.nav-link').forEach((link, idx) => {
            link.addEventListener('click', (e) => { e.preventDefault(); gotoSlide(idx); });
        });
        
        document.getElementById('app-logo').addEventListener('click', () => gotoSlide(0));

        // GLOBAL TAB LISTENER
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const targetTab = e.target.dataset.tab;
                
                // Find parent container to scope active class removal (handle multiple tab groups)
                const parentGroup = e.target.closest('.standings-tabs') || e.target.parentNode;
                if(parentGroup.classList.contains('standings-tabs')) {
                     parentGroup.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                     e.target.classList.add('active');
                     
                     // Find relevant view container
                     const wrapper = e.target.closest('.slide-content').querySelector('.standings-wrapper');
                     if(wrapper) {
                         wrapper.querySelectorAll('.standings-view').forEach(v => v.classList.remove('active-view'));
                         const targetView = document.getElementById('view-'+targetTab);
                         if(targetView) {
                             targetView.classList.add('active-view');
                             
                             // Trigger specific render functions if needed on tab switch
                             if(targetTab === 'constructors') {
                                 gsap.fromTo('.constructor-card', {y: 50, opacity: 0}, {y: 0, opacity: 1, stagger: 0.1, duration: 0.5, clearProps: "all"});
                             } else if (targetTab === 'dotd' || targetTab === 'archive-dotd') {
                                 gsap.fromTo('.dotd-panel', { width: "10%", opacity: 0 }, { width: "auto", opacity: 1, duration: 0.8, stagger: 0.05, ease: "power2.out", clearProps: "width" });
                             } else if (targetTab === 'archive-season-awards') {
                                 gsap.fromTo('.award-card', {y: 50, opacity: 0}, {y: 0, opacity: 1, stagger: 0.1, duration: 0.5, clearProps: "all"});
                             } else if (targetTab === 'archive-teams') {
                                 renderArchiveTeams(); // Ensure updated
                             }
                         }
                     }
                }
            });
        });

        // Synced Countdown Logic with Next Race Text
        function updateCountdown() {
            const now = new Date();
            let nextRace = null;
            let nextRaceInfo = null;

            // Find the next race from activeTracks
            for (const race of activeTracks) {
                if(!race.date) continue;
                const raceDate = new Date(race.date + "T13:00:00"); // Assume 1PM race start if not specified
                if (raceDate > now) {
                    nextRace = raceDate;
                    nextRaceInfo = race;
                    break;
                }
            }

            const infoEl = document.getElementById('next-race-info');

            // If no race found (Season Ended)
            if (!nextRace) {
                if(infoEl) infoEl.innerText = "SEASON COMPLETED // WAITING FOR SEASON 2";
                return;
            }

            // Update info text if race exists
            if(infoEl && nextRaceInfo) {
                // Use metadata for pretty name
                const meta = TRACK_METADATA[nextRaceInfo.id] || { gp: nextRaceInfo.name };
                const displayName = meta.gp.toUpperCase();
                
                // Format date nicely
                const day = nextRace.getDate();
                const month = nextRace.toLocaleString('default', { month: 'short' }).toUpperCase();
                infoEl.innerText = `NEXT RACE: ${displayName} // ${day} ${month}`;
            }

            function tick() {
                const current = new Date();
                const diff = nextRace - current;
                
                if (diff <= 0) return;

                const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                const h = Math.floor((diff / (1000 * 60 * 60)) % 24);
                const m = Math.floor((diff / 1000 / 60) % 60);
                const s = Math.floor((diff / 1000) % 60);

                const elD = document.getElementById('cd-days');
                const elH = document.getElementById('cd-hours');
                const elM = document.getElementById('cd-mins');
                const elS = document.getElementById('cd-secs');

                if(elD) elD.innerText = String(d).padStart(2, '0');
                if(elH) elH.innerText = String(h).padStart(2, '0');
                if(elM) elM.innerText = String(m).padStart(2, '0');
                if(elS) elS.innerText = String(s).padStart(2, '0');
            }
            setInterval(tick, 1000);
            tick();
        }

        window.onload = () => {
            gsap.to('#load-bar', { width: '100%', duration: 1, onComplete: () => {
                gsap.to('#loader', { y: '-100%', duration: 0.8 });
                // Initialize Data (Default Season 1)
                loadSeasonData(null); 
                renderDOTD();
                renderSeasonAwards(); // Initial render of Season Awards
            }});
            
            const cursor = document.getElementById('cursor');
            const follower = document.getElementById('cursor-follower');
            document.addEventListener('mousemove', (e) => {
                cursor.style.left = e.clientX + 'px'; cursor.style.top = e.clientY + 'px';
                if(follower) gsap.to(follower, { x: e.clientX - 20, y: e.clientY - 20, duration: 0.1 });
            });
            
            VANTA.NET({
                el: "#vanta-bg", mouseControls: true, touchControls: true, gyroControls: false,
                minHeight: 200.00, minWidth: 200.00, scale: 1.00, scaleMobile: 1.00,
                color: 0x00f0ff, backgroundColor: 0x050505, points: 12.00, maxDistance: 22.00, spacing: 18.00
            });
        };
    </script>
</body>
</html>
