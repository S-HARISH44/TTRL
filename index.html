<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Turbo Tribe Racing League - Elite F1 25 Sim Racing Competition">
    <title>TTRL | Racing League</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    <style>
        :root {
            --bg-main: #050505;
            --accent-red: #ff1f4b;
            --accent-cyan: #00f0ff;
            --text-primary: #ffffff;
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-bg: rgba(20, 20, 20, 0.6);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; cursor: none; }
        
        html, body {
            width: 100%; height: 100%; margin: 0; padding: 0;
            background-color: var(--bg-main);
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            overflow: hidden;
            overscroll-behavior: none;
        }

        /* --- CUSTOM CURSOR --- */
        #cursor, #cursor-follower {
            position: fixed; top: 0; left: 0; pointer-events: none; z-index: 9999;
            transform: translate(-50%, -50%); border-radius: 50%;
            will-change: transform, left, top;
        }
        #cursor {
            width: 8px; height: 8px; background: var(--accent-cyan);
            transition: width 0.2s, height 0.2s, background 0.2s;
        }
        #cursor-follower {
            width: 40px; height: 40px; border: 1px solid rgba(255,255,255,0.3);
            transition: transform 0.1s ease-out, width 0.3s, height 0.3s, border-color 0.3s;
        }
        body.hovering #cursor { width: 0px; height: 0px; opacity: 0; }
        body.hovering #cursor-follower {
            width: 60px; height: 60px; border-color: var(--accent-red);
            background: rgba(255, 31, 75, 0.1); mix-blend-mode: screen;
        }

        @media (max-width: 768px) {
            * { cursor: auto !important; }
            #cursor, #cursor-follower { display: none !important; }
        }

        /* --- LOADER --- */
        #loader {
            position: fixed; inset: 0; z-index: 10000; background: #000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .loader-bar { width: 200px; height: 2px; background: #333; margin-top: 20px; position: relative; overflow: hidden; }
        .loader-progress {
            position: absolute; top: 0; left: 0; height: 100%; width: 0%;
            background: var(--accent-cyan); box-shadow: 0 0 10px var(--accent-cyan);
        }

        /* --- UI COMPONENTS --- */
        .fixed-ui {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 100;
            padding: 1rem 2rem;
            display: flex; justify-content: space-between; align-items: center;
            pointer-events: none;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8) 0%, transparent 100%);
        }
        
        .logo { height: 3.5rem; width: auto; pointer-events: auto; cursor: pointer; transition: transform 0.3s ease; }
        .logo:hover { transform: scale(1.05); }
        .header-right { display: flex; align-items: center; gap: 1.5rem; }
        
        .top-nav {
            display: flex; gap: 1rem; pointer-events: auto;
            font-family: 'Rajdhani', sans-serif; font-weight: 700;
            text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.9rem;
        }
        .top-nav a {
            color: rgba(255, 255, 255, 0.6); text-decoration: none; position: relative;
            padding: 0.5rem 0.5rem; transition: color 0.3s ease; cursor: pointer;
        }
        .top-nav a:hover { color: var(--accent-cyan); }
        .top-nav a::after {
            content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 0; height: 2px; background: var(--accent-red); transition: width 0.3s ease;
        }
        .top-nav a.active { color: var(--text-primary); }
        .top-nav a.active::after { width: 100%; background: var(--accent-cyan); }
        
        /* --- SLIDES --- */
        .slides-wrapper { position: fixed; inset: 0; width: 100%; height: 100%; }
        .slide {
            position: absolute; inset: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            visibility: hidden; overflow: hidden; opacity: 0;
            will-change: opacity, transform;
        }
        .slide.active { visibility: visible; z-index: 10; opacity: 1; }

        .slide-bg {
            position: absolute; inset: 0; z-index: 1;
            background-size: cover; background-position: center;
            filter: brightness(0.3) grayscale(0.2);
            transform: scale(1.1); will-change: transform;
        }
        #vanta-bg { filter: brightness(1) grayscale(0); }
        #vanta-bg canvas { width: 100% !important; height: 100% !important; }

        .slide-content {
            position: relative; z-index: 3; max-width: 1400px; width: 100%; padding: 0 4vw;
            display: flex; flex-direction: column; justify-content: center; height: 100%;
        }
        
        #slide-2 .slide-content, #slide-5 .slide-content { justify-content: flex-start; padding-top: 6vh; }

        /* --- TYPOGRAPHY --- */
        .tech-font { font-family: 'Rajdhani', sans-serif; text-transform: uppercase; line-height: 0.9; }
        .mono-font { font-family: 'JetBrains Mono', monospace; }
        
        .slide-tag {
            display: inline-block; padding: 0.3rem 0.8rem; margin-bottom: 1rem;
            border-left: 2px solid var(--accent-cyan); color: var(--accent-cyan);
            font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.2em;
            background: linear-gradient(90deg, rgba(0, 240, 255, 0.1), transparent);
        }
        
        .slide-title {
            font-size: clamp(2rem, 5vw, 4rem); font-weight: 800; margin-bottom: 0.5rem;
            color: #fff; position: relative; z-index: 2; mix-blend-mode: hard-light;
        }
        .text-outline { -webkit-text-stroke: 1px rgba(255,255,255,0.85); color: transparent; }

        /* --- STANDINGS --- */
        .standings-tabs { display: flex; gap: 1rem; margin-bottom: 1rem; overflow-x: auto; padding-bottom: 5px;}
        .tab-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.2); color: rgba(255,255,255,0.5);
            padding: 0.5rem 1.5rem; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 0.9rem;
            text-transform: uppercase; letter-spacing: 0.1em; pointer-events: auto; transition: all 0.3s ease;
            white-space: nowrap; cursor: pointer;
        }
        .tab-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .tab-btn.active { background: var(--accent-red); color: #fff; border-color: var(--accent-red); box-shadow: 0 0 20px rgba(255,31,75,0.3); }

        .standings-wrapper { width: 100%; height: 75vh; margin-top: 0.5rem; position: relative; }
        .standings-view {
            position: absolute; inset: 0; width: 100%; height: 100%;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0; visibility: hidden; transform: translateY(20px); pointer-events: none;
        }
        .standings-view.active-view { opacity: 1; visibility: visible; transform: translateY(0); pointer-events: auto; }

        .table-scroll { height: 100%; overflow: auto; padding-right: 1rem; scrollbar-width: none; }
        .table-scroll::-webkit-scrollbar { display: none; }
        
        .standings-table { width: 100%; border-collapse: separate; border-spacing: 0 0.5rem; font-family: 'JetBrains Mono', monospace; }
        .standings-table th {
            text-align: left; color: var(--accent-cyan); padding: 0.8rem;
            position: sticky; top: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 10;
            font-family: 'Rajdhani', sans-serif; font-weight: 700; letter-spacing: 0.1em;
            white-space: nowrap; font-size: 0.9rem;
        }
        .standings-table td { padding: 0.8rem; background: var(--glass-bg); border-top: 1px solid transparent; border-bottom: 1px solid transparent; transition: all 0.2s ease; white-space: nowrap; font-size: 0.9rem;}
        .standings-table td:first-child { border-radius: 4px 0 0 4px; border-left: 3px solid var(--team-color, transparent); }
        .standings-table td:last-child { border-radius: 0 4px 4px 0; border-right: 1px solid transparent; }
        .standings-table tr:hover td { background: rgba(255, 255, 255, 0.1); transform: scale(1.01); }
        
        .team-cell { display: flex; align-items: center; gap: 0.8rem; }
        .team-logo-mini { height: 20px; width: auto; max-width: 30px; object-fit: contain; }

        /* --- GARAGE GRID --- */
        .garage-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem; height: 100%; overflow-y: auto; padding: 0.5rem 1rem 2rem 1rem;
            scrollbar-width: none;
        }
        .garage-grid::-webkit-scrollbar { display: none; }
        
        @media (min-width: 1200px) { .garage-grid { grid-template-columns: repeat(5, 1fr); } }

        .constructor-card {
            background: linear-gradient(145deg, rgba(30,30,30,0.6) 0%, rgba(10,10,10,0.8) 100%);
            border: 1px solid var(--glass-border); border-radius: 12px; padding: 1rem;
            display: flex; flex-direction: column; position: relative;
            transform-style: preserve-3d; transition: transform 0.1s linear, box-shadow 0.3s ease;
            height: 100%; justify-content: space-between;
        }
        .constructor-card:hover { border-color: var(--team-color, #fff); }
        
        .cc-bg-rank { position: absolute; top: -0.5rem; right: 0.5rem; font-size: 4rem; font-family: 'Rajdhani'; font-weight: 800; color: rgba(255,255,255,0.03); pointer-events: none; }
        .cc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; z-index: 2; transform: translateZ(30px); }
        .cc-name { font-family: 'Rajdhani'; font-weight: 700; font-size: 1rem; }
        .cc-points { color: var(--team-color); font-family: 'JetBrains Mono'; font-weight: 700; background: rgba(0,0,0,0.5); padding: 0.2rem 0.4rem; border-radius: 4px; }
        .cc-img-container { flex-grow: 1; display: flex; align-items: center; justify-content: center; transform: translateZ(50px); height: 70px; }
        .cc-car-img { max-width: 100%; max-height: 100%; object-fit: contain; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5)); }

        /* --- DOTD (Accordion) --- */
        .dotd-accordion-container { width: 100%; height: 100%; display: flex; flex-direction: column; gap: 0; overflow: hidden; }
        @media (min-width: 768px) { .dotd-accordion-container { flex-direction: row; } }
        .dotd-panel {
            flex: 1; display: flex; position: relative; background-size: cover; background-position: center top;
            background-repeat: no-repeat; overflow: hidden; transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
            cursor: pointer; min-height: 60px; border: 1px solid rgba(255,255,255,0.05);
        }
        .dotd-panel::before {
            content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.9) 100%);
            z-index: 1; transition: background 0.5s;
        }
        .dotd-panel:hover { flex: 4; cursor: default; border-color: var(--team-color); }
        .dotd-panel:hover::before { background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.8) 100%); }
        .dotd-label {
            position: absolute; z-index: 2; top: 50%; left: 50%; transform: translate(-50%, -50%);
            white-space: nowrap; font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1.2rem;
            text-transform: uppercase; color: rgba(255,255,255,0.7); transition: all 0.3s;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8); pointer-events: none;
        }
        @media (min-width: 768px) {
            .dotd-label { transform: translate(-50%, -50%) rotate(-90deg); font-size: 1.5rem; }
            .dotd-panel:hover .dotd-label { opacity: 0; transform: translate(-50%, -200%) rotate(-90deg); }
        }
        @media (max-width: 767px) {
            .dotd-panel:hover .dotd-label { opacity: 0; transform: translate(-200%, -50%); }
        }
        .dotd-content {
            position: absolute; bottom: 0; left: 0; width: 100%; padding: 1.5rem; z-index: 3;
            opacity: 0; transform: translateY(20px); transition: all 0.4s 0.1s ease-out;
            display: flex; flex-direction: column; justify-content: flex-end;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
        }
        .dotd-panel:hover .dotd-content { opacity: 1; transform: translateY(0); }
        .dotd-gp-name { color: var(--accent-cyan); font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; margin-bottom: 0.5rem; letter-spacing: 1px; }
        .dotd-driver-name { color: #fff; font-family: 'Rajdhani', sans-serif; font-size: 2rem; font-weight: 800; line-height: 1; text-transform: uppercase; margin-bottom: 0.5rem; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .dotd-team-name { color: var(--team-color); font-family: 'Rajdhani', sans-serif; font-size: 1rem; font-weight: 600; text-transform: uppercase; }
        .dotd-badge-icon {
            position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; color: #FFD700; opacity: 0;
            transform: scale(0); transition: all 0.3s 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 4; filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5));
        }
        .dotd-panel:hover .dotd-badge-icon { opacity: 1; transform: scale(1); }

        /* --- CALENDAR GRID --- */
        .cal-grid { display: flex; flex-wrap: wrap; gap: 1rem; max-width: 1200px; margin-top: 1rem; }
        .cal-item {
            border: 1px solid var(--glass-border); padding: 1.2rem; text-align: center;
            transition: transform 0.2s ease, opacity 0.2s ease, border-color 0.2s ease;
            display: flex; flex-direction: column; justify-content: center;
            background: var(--glass-bg); opacity: 0.5; flex: 1 1 140px; min-width: 140px;
            position: relative; overflow: hidden;
        }
        .cal-item::before {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 2px;
            background: var(--accent-cyan); transform: scaleX(0); transition: transform 0.3s ease;
        }
        .cal-item:hover { opacity: 1 !important; transform: translateY(-5px); border-color: rgba(255,255,255,0.3); }
        .cal-item:hover::before { transform: scaleX(1); }
        .cal-item.future-race { opacity: 0.8; }
        .cal-item.next-race { opacity: 1; border: 1px solid var(--accent-cyan); background: rgba(0, 240, 255, 0.05); box-shadow: 0 0 30px rgba(0, 240, 255, 0.1); }
        .cal-item.next-race .gp { color: var(--accent-cyan); text-shadow: 0 0 10px var(--accent-cyan); }
        .round { font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; color: var(--accent-red); display: block; margin-bottom: 0.3rem; letter-spacing: 0.1em; }
        .gp { font-family: 'Rajdhani', sans-serif; font-weight: 700; font-size: 1.2rem; color: #fff; line-height: 1.1; margin-bottom: 0.3rem; display: block; }
        .date { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: #888; display: block; }
        .btn-ai-intel {
            margin-top: 0.8rem; padding: 0.4rem; background: rgba(255,255,255,0.1); 
            border: 1px solid var(--accent-cyan); color: var(--accent-cyan); font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem; cursor: pointer; pointer-events: auto; transition: all 0.2s;
            text-transform: uppercase; border-radius: 4px; display: flex; align-items: center; justify-content: center; gap: 5px;
        }
        .btn-ai-intel:hover { background: var(--accent-cyan); color: #000; }

        /* --- ARCHIVE SECTION --- */
        .archive-controls { margin-bottom: 1rem; display: flex; gap: 10px; }
        .archive-loading { text-align: center; padding: 2rem; color: var(--accent-cyan); font-family: 'JetBrains Mono'; }
        .season-btn-group {
            display: flex; gap: 10px; justify-content: center; margin-bottom: 1rem; flex-wrap: wrap;
        }

        /* Sticky Headers for Archive */
        .sticky-left { position: sticky; left: 0; z-index: 20; background: #000; border-right: 1px solid rgba(255,255,255,0.1); }
        .sticky-top { position: sticky; top: 0; z-index: 30; background: #000; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .sticky-corner { position: sticky; left: 0; top: 0; z-index: 40; background: #000; border-right: 1px solid rgba(255,255,255,0.1); border-bottom: 1px solid rgba(255,255,255,0.1); }

        /* Other UI */
        .btn-tech {
            pointer-events: auto; display: inline-block; padding: 0.8rem 2.5rem;
            background: var(--accent-red); color: #fff; font-family: 'Rajdhani'; font-weight: 700;
            text-decoration: none; clip-path: polygon(0 0, 100% 0, 95% 100%, 5% 100%);
        }
        .countdown-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 3rem; }
        .countdown-item { background: rgba(20, 20, 20, 0.4); border: 1px solid var(--glass-border); border-top: 2px solid var(--accent-red); padding: 0.8rem; text-align: center; }
        .countdown-val { font-family: 'JetBrains Mono'; font-size: 2.5rem; font-weight: 700; display: block; }
        .countdown-label { font-size: 0.7rem; color: var(--accent-red); letter-spacing: 0.2em; }
        
        /* Contact Grid */
        .contact-grid { display: flex; gap: 2rem; flex-wrap: wrap; margin-top: 2rem; }
        .contact-item {
            display: flex; align-items: center; gap: 1rem; padding: 1.5rem 2rem;
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            color: #fff; text-decoration: none; transition: all 0.3s ease; pointer-events: auto;
        }
        .contact-item:hover { background: #fff; color: #000; transform: translateY(-5px); }

        /* Modals */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); 
            backdrop-filter: blur(10px); z-index: 9990; display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; pointer-events: none; transition: all 0.3s ease;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; pointer-events: auto; }
        
        .intel-modal {
            width: 90%; max-width: 800px; background: #000; border: 1px solid var(--accent-cyan);
            padding: 2rem; position: relative; clip-path: polygon(0 0, 100% 0, 100% 90%, 95% 100%, 0 100%);
            display: flex; flex-direction: column;
        }
        .intel-title { color: var(--accent-cyan); font-family: 'Rajdhani', sans-serif; font-size: 2rem; margin-bottom: 1rem; text-transform: uppercase; }
        .intel-content-layout {
            display: grid; grid-template-columns: 3fr 2fr; gap: 2rem; flex-grow: 1; max-height: 55vh; overflow: hidden;
        }
        .intel-left-column, .intel-right-column { overflow-y: auto; padding-right: 10px; }
        .intel-map-container { flex-shrink: 0; width: 100%; height: 0; padding-bottom: 56.25%; position: relative; }
        .intel-map-container img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; filter: brightness(0.8) contrast(1.1); }
        .ai-briefing { font-family: 'JetBrains Mono', monospace; line-height: 1.6; color: #ccc; }
        .close-modal { cursor: pointer; font-size: 1.5rem; color: #fff; transition: color 0.2s; float: right; }
        .close-modal:hover { color: var(--accent-cyan); }
        .setup-display { margin-bottom: 1.5rem; border: 1px solid var(--accent-red); padding: 1rem; background: rgba(255, 31, 75, 0.05); }
        .setup-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; text-align: left; }
        .setup-table td { padding: 0.4rem 0.5rem; border-bottom: 1px dashed rgba(255,255,255,0.1); }
        .setup-table td:first-child { color: var(--accent-cyan); font-weight: 700; width: 50%; }
        .setup-table td:last-child { text-align: right; color: #fff; font-weight: 500; }

        @media (max-width: 768px) {
            .fixed-ui { padding: 1rem; }
            .top-nav { display: none; }
            .countdown-grid { grid-template-columns: repeat(2, 1fr); }
            .slide-title { font-size: 3rem; }
            .garage-grid { grid-template-columns: 1fr; }
            .intel-content-layout { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div id="cursor"></div><div id="cursor-follower"></div>

    <div id="loader">
        <div class="tech-font" style="letter-spacing: 0.3em; font-size: 1.5rem;">INITIALIZING RACE CONTROL</div>
        <div class="loader-bar"><div class="loader-progress" id="load-bar"></div></div>
    </div>

    <div class="fixed-ui">
        <img id="app-logo" src="https://raw.githubusercontent.com/HARISHWINNER/TTRL/ade50d630c482acbb96676fc69c2849a58494f7f/RESOURCES/image.png" alt="TTRL" class="logo hover-target">
        <div class="header-right">
            <div class="top-nav">
                <a href="#" class="nav-link active hover-target" data-slide="0">HOME</a>
                <a href="#" class="nav-link hover-target" data-slide="1">CALENDAR</a>
                <a href="#" class="nav-link hover-target" data-slide="2">STANDINGS</a>
                <a href="#" class="nav-link hover-target" data-slide="3">REGISTER</a>
                <a href="#" class="nav-link hover-target" data-slide="4">PADDOCK</a>
                <a href="#" class="nav-link hover-target" data-slide="5">ARCHIVES</a>
            </div>
            <div class="mono-font text-sm uppercase tracking-widest"><span style="color: var(--accent-cyan)">Season 1</span> <span style="color: #666">// Completed</span></div>
        </div>
    </div>

    <!-- INTEL MODAL -->
    <div class="modal-overlay" id="intel-modal-overlay">
        <div class="intel-modal">
            <div style="margin-bottom:1rem; overflow:hidden;">
                <span class="close-modal hover-target" onclick="closeIntel()">&times;</span>
                <span style="color:var(--accent-cyan); font-family:'Rajdhani'; font-weight:700;">TACTICAL BRIEFING</span>
            </div>
            <div class="intel-title" id="intel-title">GP NAME</div>
            <div class="intel-content-layout">
                <div class="intel-left-column">
                    <div class="intel-map-container"><img id="intel-map" src="" alt="Map"></div>
                    <div id="ai-briefing" class="ai-briefing" style="margin-top:1rem;"></div>
                </div>
                <div class="intel-right-column">
                    <div id="setup-display" class="setup-display mono-font"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="slides-wrapper">
        <!-- SLIDE 0: HERO -->
        <section class="slide active" id="slide-0">
            <div class="slide-bg" style="background-image: url('https://raw.githubusercontent.com/S-HARISH44/TTRL/577532eaacf8de58ca32f2b9e5d0112cf71a3689/RESOURCES/001-EA-Sports-F1-2023-Video-Game-Review.jpg')"></div>
            <div class="slide-content" style="align-items: center; text-align: center;">
                <div class="slide-tag" id="hero-next-tag">SEASON COMPLETED</div>
                <h1 class="slide-title tech-font"><span class="glitch-effect" data-text="TURBO">TURBO</span> <span class="text-outline glitch-effect" data-text="TRIBE">TRIBE</span></h1>
                <div class="countdown-grid hover-target" id="hero-countdown">
                    <div class="countdown-item"><span class="countdown-val" id="cd-days">00</span><span class="countdown-label">DAYS</span></div>
                    <div class="countdown-item"><span class="countdown-val" id="cd-hours">00</span><span class="countdown-label">HRS</span></div>
                    <div class="countdown-item"><span class="countdown-val" id="cd-minutes">00</span><span class="countdown-label">MIN</span></div>
                    <div class="countdown-item"><span class="countdown-val" id="cd-seconds">00</span><span class="countdown-label">SEC</span></div>
                </div>
                <div class="btn-container"><button id="start-engine-btn" class="btn-tech hover-target">ENTER PADDOCK</button></div>
            </div>
        </section>

        <!-- SLIDE 1: CALENDAR -->
        <section class="slide" id="slide-1">
            <div class="slide-bg" style="background-image: url('https://raw.githubusercontent.com/S-HARISH44/TTRL/577532eaacf8de58ca32f2b9e5d0112cf71a3689/RESOURCES/Belgium.avif')"></div>
            <div class="slide-content">
                <div class="slide-tag">02 // GLOBAL TOUR</div>
                <h2 class="slide-title tech-font">RACE <span class="text-outline">CALENDAR</span></h2>
                <div id="calendar-grid" class="cal-grid mono-font"></div>
            </div>
        </section>

        <!-- SLIDE 2: STANDINGS (FIREBASE CONNECTED) -->
        <section class="slide" id="slide-2">
            <div class="slide-bg" style="background-image: url('https://f1chronicle.com/wp-content/uploads/2024/01/SI202412010400-1920x1080.jpg')"></div>
            <div class="slide-content">
                <div class="slide-tag">03 // LEADERBOARD</div>
                <h2 class="slide-title tech-font">TOP <span class="text-outline">PERFORMERS</span></h2>
                <div class="standings-tabs">
                    <button class="tab-btn active hover-target" data-tab="drivers">DRIVERS</button>
                    <button class="tab-btn hover-target" data-tab="constructors">TEAMS</button>
                    <!-- REMOVED DOTD FROM HERE -->
                </div>
                <div class="standings-wrapper">
                    <!-- DRIVERS -->
                    <div class="standings-view active-view" id="view-drivers">
                         <div class="table-scroll">
                            <table class="standings-table">
                                <thead><tr><th>POS</th><th>DRIVER</th><th>TEAM</th><th>PTS</th></tr></thead>
                                <tbody id="drivers-body"><tr><td colspan="4" class="archive-loading">CONNECTING TO DATABASE...</td></tr></tbody>
                            </table>
                        </div>
                    </div>
                    <!-- CONSTRUCTORS -->
                    <div class="standings-view" id="view-constructors">
                        <div class="garage-grid" id="garage-grid">
                            <div class="archive-loading">CALCULATING POINTS...</div>
                        </div>
                    </div>
                    <!-- DOTD REMOVED FROM HERE -->
                </div>
            </div>
        </section>

        <!-- SLIDE 3: REGISTER -->
        <section class="slide" id="slide-3">
            <div class="slide-bg" style="background-image: url('https://raw.githubusercontent.com/S-HARISH44/TTRL/577532eaacf8de58ca32f2b9e5d0112cf71a3689/RESOURCES/1-w-GettyImages-2048270135.webp')"></div>
            <div class="slide-content">
                <div class="slide-tag">04 // ENLIST</div>
                <h2 class="slide-title tech-font">JOIN <span class="text-outline">THE GRID</span></h2>
                <div class="btn-container"><a href="https://docs.google.com/forms/d/e/1FAIpQLSc1xE8SkAOIKoHaryLjNgTNXJfmBCSv73vdgxaAA0_uxnmUTw/viewform" target="_blank" class="btn-tech hover-target">REGISTER NOW</a></div>
            </div>
        </section>

         <!-- SLIDE 4: PADDOCK (ADDED EMAIL) -->
        <section class="slide" id="slide-4">
            <div class="slide-bg" id="vanta-bg"></div>
            <div class="slide-content">
                <div class="slide-tag">05 // PADDOCK</div>
                <h2 class="slide-title tech-font">CONNECT <span class="text-outline">WITH US</span></h2>
                <div class="contact-grid mono-font">
                    <a href="https://discord.gg/EuyPTXqbg6" target="_blank" class="contact-item hover-target"><i class="fa-brands fa-discord"></i> <span>DISCORD</span></a>
                    <a href="https://www.youtube.com/@TurboTribeRacingLeague" target="_blank" class="contact-item hover-target"><i class="fa-brands fa-youtube"></i> <span>YOUTUBE</span></a>
                    <a href="mailto:turbotriberacingleague@gmail.com" class="contact-item hover-target"><i class="fa-solid fa-envelope"></i> <span>EMAIL</span></a>
                </div>
            </div>
        </section>

        <!-- SLIDE 5: ARCHIVES (SEASON SELECTOR + TABS) -->
        <section class="slide" id="slide-5">
            <div class="slide-bg" style="background-image: url('https://media.formula1.com/image/upload/f_auto,c_limit,w_1440,q_auto/f_auto/q_auto/content/dam/fom-website/manual/Misc/2021-Master-Folder/Mercedes%20W12/MERCEDES_AMG_PETRONAS_F1_W12_E_PERFORMANCE_04'); filter: brightness(0.2);"></div>
            <div class="slide-content">
                <div class="slide-tag">06 // DATA VAULT</div>
                <h2 class="slide-title tech-font">SEASON <span class="text-outline">ARCHIVES</span></h2>
                
                <!-- Season Selector -->
                <div class="archive-controls">
                    <div class="season-btn-group">
                        <button class="tab-btn active" onclick="setSeason('season_1')">SEASON 1</button>
                        <button class="tab-btn" onclick="setSeason('season_2')">SEASON 2</button>
                    </div>
                </div>

                <!-- Tabs for Driver/Team/Awards -->
                <div class="standings-tabs" style="justify-content: center;">
                    <button class="tab-btn active hover-target" data-tab="archive-drivers">DRIVERS</button>
                    <button class="tab-btn hover-target" data-tab="archive-teams">TEAMS</button>
                    <button class="tab-btn hover-target" data-tab="archive-dotd">AWARDS</button>
                </div>

                <div class="standings-wrapper" style="height: 55vh;">
                    <!-- DRIVER ARCHIVE -->
                    <div class="standings-view active-view" id="view-archive-drivers">
                        <div class="table-scroll" id="archives-drivers-container">
                             <div class="archive-loading">LOADING DRIVER MATRIX...</div>
                        </div>
                    </div>

                    <!-- TEAM ARCHIVE -->
                    <div class="standings-view" id="view-archive-teams">
                        <div class="table-scroll" id="archives-teams-container">
                             <div class="archive-loading">LOADING TEAM MATRIX...</div>
                        </div>
                    </div>

                    <!-- DOTD ARCHIVE -->
                    <div class="standings-view" id="view-archive-dotd">
                        <div class="dotd-accordion-container" id="dotd-container"></div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanta/0.5.24/vanta.net.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyApUD33ao9DfFa8IAfA2qby3IFKhLtcNFU",
            authDomain: "ttrl-9f3ef.firebaseapp.com",
            projectId: "ttrl-9f3ef",
            storageBucket: "ttrl-9f3ef.firebasestorage.app",
            messagingSenderId: "51144639440",
            appId: "1:51144639440:web:8a027b773bc2cddefe2fd5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // API KEY
        const _k_parts = ["AIzaSyBUpBE", "iHMqvfc5PCFn", "3aqTwfBZg8d9QThI"];
        const apiKey = _k_parts.join('');

        // DATA CONSTANTS
        const TEAMS = [
            {id:'red-bull-racing', name:'Red Bull'}, {id:'ferrari', name:'Ferrari'}, {id:'mercedes', name:'Mercedes'},
            {id:'mclaren', name:'McLaren'}, {id:'aston-martin', name:'Aston Martin'}, {id:'alpine', name:'Alpine'},
            {id:'williams', name:'Williams'}, {id:'racing-bulls', name:'Racing Bulls'}, {id:'kick-sauber', name:'Kick Sauber'},
            {id:'haas', name:'Haas'}, {id:'reserve', name:'Reserve'}
        ];
        
        const TRACK_KEYS = ['bahrain', 'australia', 'imola', 'spain', 'uk', 'vegas', 'belgium', 'austria', 'brazil', 'abu_dhabi'];
        const TRACK_LABELS = {
            'bahrain': 'BAH', 'australia': 'AUS', 'imola': 'IMO', 'spain': 'ESP',
            'uk': 'GBR', 'vegas': 'LVG', 'belgium': 'BEL', 'austria': 'AUT',
            'brazil': 'BRA', 'abu_dhabi': 'ABU'
        };

        const TEAM_COLORS = {
            "red-bull-racing": "#3671C6", "ferrari": "#E80020", "mercedes": "#27F4D2", "mclaren": "#FF8000",
            "aston-martin": "#229971", "alpine": "#0093CC", "williams": "#64C4FF", "racing-bulls": "#6692FF",
            "kick-sauber": "#52E252", "haas": "#B6BABD", "reserve": "#666666"
        };
        const CAR_IMAGES = {
            "red-bull-racing": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025redbullracingcarright.png",
            "ferrari": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025ferraricarright.png",
            "mercedes": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025mercedescarright.png",
            "mclaren": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025mclarencarright.png",
            "aston-martin": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025astonmartincarright.png",
            "alpine": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025alpinecarright.png",
            "williams": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025williamscarright.png",
            "racing-bulls": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025racingbullscarright.png",
            "kick-sauber": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025kicksaubercarright.png",
            "haas": "https://raw.githubusercontent.com/S-HARISH44/TTRL/81a0eb55cacfee2f08a1b599ecd314608b6b0424/RESOURCES/Constructor/2025haasf1teamcarright.png"
        };

        const CALENDAR = [
            { round: 1, gp: "Bahrain GP", date: "19/09", insight: "Night race." }, 
            { round: 2, gp: "Australia GP", date: "26/09", insight: "Street circuit." },
            { round: 3, gp: "Imola GP", date: "03/10", insight: "Old school." }, 
            { round: 4, gp: "Spain GP", date: "10/10", insight: "High deg." },
            { round: 5, gp: "Great Britain GP", date: "24/10", insight: "Fast corners." }, 
            { round: 6, gp: "Las Vegas GP", date: "31/10", insight: "Cold temps." },
            { round: 7, gp: "Belgium GP", date: "07/11", insight: "Long lap." }, 
            { round: 8, gp: "Austria GP", date: "14/11", insight: "Short lap." },
            { round: 9, gp: "Brazil GP", date: "21/11", insight: "Weather chaos." }, 
            { round: 10, gp: "Abu Dhabi GP", date: "28/11", insight: "Finale." }
        ];

        const DOTD_DATA = [
            { gp: "Bahrain Grand Prix", driver: "Sanju Vibhi", team: "ASTON MARTIN", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Sanju.png", desc: "Voted Driver of the Day for a stellar performance." },
            { gp: "Australian Grand Prix", driver: "Apex Entropy", team: "KICK SAUBER", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Apex%201.png", desc: "Exceptional pace down under at Albert Park." },
            { gp: "Emilia Romagna GP", driver: "Mahesh", team: "WILLIAMS", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Mahesh.png", desc: "A fan-favorite drive at Imola's historic circuit." },
            { gp: "Spanish Grand Prix", driver: "Apex Entropy", team: "ALPINE", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Apex.png", desc: "Superb driving at Catalunya earned the fans' vote." },
            { gp: "Great Britain GP", driver: "Sanju Vibhi", team: "ASTON MARTIN", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Sanju%201.png", desc: "A standout performance at Silverstone." },
            { gp: "Las Vegas Grand Prix", driver: "Harish", team: "HAAS", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Harish.png", desc: "Electrifying drive on the Vegas Strip." },
            { gp: "Belgian Grand Prix", driver: "Sandeep Mareedu", team: "RACING BULLS", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Sandeep.png", desc: "Incredible drive as a reserve for Racing Bulls." },
            { gp: "Austrian Grand Prix", driver: "Wi7ard", team: "WILLIAMS", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Wizard.png", desc: "Magical performance at the Red Bull Ring." },
            { gp: "São Paulo Grand Prix", driver: "TheGodfather", team: "ALPINE", image: "https://raw.githubusercontent.com/S-HARISH44/TTRL/59bd92e0c4dff4bded6f75ae03ddf28148b4779a/RESOURCES/DOTD/Godfather.png", desc: "An offer Interlagos couldn't refuse." },
            { gp: "Abu Dhabi Grand Prix", driver: "Wi7ard", team: "WILLIAMS", image: "https://github.com/S-HARISH44/TTRL/blob/ef6d28c8baa4a8e9c15f64a76f854e80a95fadbc/RESOURCES/DOTD/Lime_Green_and_Black_Dynamic_Match_Instagram_Post_4.png?raw=true", desc: "Dominant performance to end the season." }
        ];

        const f125SetupData = {
            "Australian Grand Prix": { aero: "13-9 (Q) / 9-3 (R)", differential: "100 (On) - 20 (Off)", suspGeometry: "LLLL", suspension: "41-3-7-16-21-40", brakes: "100% / 54%", tiresQ: "27.0 PSI / 23.5 PSI", tiresR: "27.5 PSI / 23.5 PSI", notes: "High deg." },
            "Bahrain Grand Prix": { aero: "20-15", differential: "80 (On) - 50 (Off)", suspGeometry: "RLRL", suspension: "5-3-9-3-20-40", brakes: "100% / 50%", tiresQ: "23.2 PSI / 21.0 PSI", tiresR: "21.2 PSI / 19.0 PSI", notes: "Rear traction focus." },
            "Emilia Romagna Grand Prix": { aero: "35-30", differential: "50 (On) - 50 (Off)", suspGeometry: "LLLR", suspension: "7-8-3-1-30-40", brakes: "100% / 52%", tiresQ: "24.0 PSI / 21.5 PSI", tiresR: "22.0 PSI / 20.0 PSI", notes: "High downforce." },
            "Spanish Grand Prix": { aero: "38-30", differential: "60 (On) - 55 (Off)", suspGeometry: "RRRR", suspension: "3-8-4-1-20-40", brakes: "100% / 55%", tiresQ: "24.2 PSI / 21.8 PSI", tiresR: "22.2 PSI / 20.8 PSI", notes: "Turn 3 kills tires." },
            "Great Britain Grand Prix": { aero: "20-15", differential: "90 (On) - 60 (Off)", suspGeometry: "LLRL", suspension: "10-1-5-1-15-30", brakes: "100% / 53%", tiresQ: "23.5 PSI / 21.0 PSI", tiresR: "21.5 PSI / 19.5 PSI", notes: "Aerodynamic efficiency." },
            "Las Vegas Grand Prix": { aero: "10-5", differential: "100 (On) - 20 (Off)", suspGeometry: "LLLL", suspension: "1-1-1-1-30-40", brakes: "100% / 50%", tiresQ: "23.0 PSI / 21.0 PSI", tiresR: "21.0 PSI / 19.0 PSI", notes: "Min drag." },
            "Belgian Grand Prix": { aero: "15-10", differential: "90 (On) - 60 (Off)", suspGeometry: "RRRL", suspension: "1-1-1-1-25-30", brakes: "100% / 50%", tiresQ: "22.8 PSI / 20.8 PSI", tiresR: "20.8 PSI / 18.8 PSI", notes: "Low drag." },
            "Austrian Grand Prix": { aero: "20-15", differential: "95 (On) - 65 (Off)", suspGeometry: "LLLR", suspension: "5-1-4-1-20-30", brakes: "100% / 54%", tiresQ: "23.0 PSI / 21.0 PSI", tiresR: "21.0 PSI / 19.0 PSI", notes: "Traction out of slow corners." },
            "São Paulo Grand Prix": { aero: "30-25", differential: "50 (On) - 50 (Off)", suspGeometry: "RRRR", suspension: "7-8-3-1-25-40", brakes: "100% / 52%", tiresQ: "24.0 PSI / 21.5 PSI", tiresR: "22.0 PSI / 20.0 PSI", notes: "Rotation needed." },
            "Abu Dhabi Grand Prix": { aero: "25-20", differential: "70 (On) - 55 (Off)", suspGeometry: "LLRL", suspension: "3-5-2-1-20-40", brakes: "100% / 53%", tiresQ: "23.8 PSI / 21.3 PSI", tiresR: "21.8 PSI / 19.8 PSI", notes: "Technical S3." }
        };

        let allDrivers = [];
        let currentSeason = 'season_1';
        let unsubscribe = null;

        // --- GEMINI & MODAL FUNCTIONS ---
        async function callGemini(prompt, systemInstruction = "") {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: systemInstruction }] }
                    })
                });
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error(error);
                return "Signal lost. Check connection.";
            }
        }

        const intelModal = document.getElementById('intel-modal-overlay');
        const intelTitle = document.getElementById('intel-title');
        const intelMap = document.getElementById('intel-map');
        const setupDisplay = document.getElementById('setup-display');
        const aiBriefing = document.getElementById('ai-briefing');

        function closeIntel() { intelModal.classList.remove('active'); }
        window.closeIntel = closeIntel; // EXPOSE FOR HTML

        function displaySetupData(setup) {
            if (!setup) {
                setupDisplay.innerHTML = "<h4>Baseline Setup Prediction</h4><p>No specific data available.</p>";
                return;
            }
            setupDisplay.innerHTML = `
                <h4>F1 25 Baseline Setup</h4>
                <table class="setup-table">
                    <tr><td>Aero (F/R)</td><td>${setup.aero}</td></tr>
                    <tr><td>Differential</td><td>${setup.differential}</td></tr>
                    <tr><td>Suspension</td><td>${setup.suspension}</td></tr>
                    <tr><td>Brakes</td><td>${setup.brakes}</td></tr>
                    <tr><td>Tires (Q/R)</td><td>${setup.tiresQ} / ${setup.tiresR}</td></tr>
                </table>
            `;
        }

        async function fetchTrackIntel(gpName) {
            intelModal.classList.add('active');
            requestAnimationFrame(async () => {
                const raceData = CALENDAR.find(r => r.gp === gpName);
                const setup = f125SetupData[gpName];
                const mapUrl = raceData ? raceData.mapUrl : 'https://placehold.co/768x432/111111/FFFFFF?text=MAP+NOT+FOUND';
                
                intelTitle.innerText = gpName.toUpperCase();
                intelMap.src = mapUrl;
                displaySetupData(setup);
                
                aiBriefing.innerHTML = `<i class="fa-solid fa-satellite-dish fa-spin"></i> DOWNLOADING BRIEFING...`;
                const prompt = `Tactical summary for ${gpName} in F1 23/24. Key overtaking & tire wear. Under 50 words.`;
                const briefing = await callGemini(prompt);
                
                aiBriefing.textContent = "";
                let i = 0;
                function typeWriter() {
                    if (i < briefing.length) {
                        aiBriefing.textContent += briefing.slice(i, i + 3);
                        i += 3;
                        if (i < briefing.length) setTimeout(() => requestAnimationFrame(typeWriter), 20); 
                    }
                }
                typeWriter();
            });
        }
        window.fetchTrackIntel = fetchTrackIntel; // EXPOSE FOR HTML

        // --- FIREBASE LOGIC ---
        function initArchiveSync(seasonId) {
            if(unsubscribe) unsubscribe();
            
            // Default to season 1 logic for main view
            // For Archives, we use the seasonId passed
            const targetSeason = seasonId || "season_1";
            
            const q = query(collection(db, "seasons", targetSeason, "drivers"), orderBy("totalPoints", "desc"));
            unsubscribe = onSnapshot(q, (snapshot) => {
                allDrivers = [];
                snapshot.forEach(doc => allDrivers.push(doc.data()));
                
                // Update based on view context
                // If seasonId is null, it means we are initializing main site data (Season 1)
                if(!seasonId) {
                    renderDrivers();
                    renderConstructors();
                }
                
                // Always update archive views when data changes
                renderArchiveDrivers();
                renderArchiveTeams();
            });
        }

        window.setSeason = (sid) => {
            currentSeason = sid;
            // Update button styles
            document.querySelectorAll('.season-btn-group .tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.innerText.toLowerCase().replace(' ', '_') === sid) btn.classList.add('active');
            });
            initArchiveSync(sid);
        };

        // 1. DRIVER STANDINGS (Main)
        function renderDrivers() {
            const tbody = document.getElementById("drivers-body");
            tbody.innerHTML = "";
            allDrivers.forEach((d, i) => {
                const color = TEAM_COLORS[d.team] || '#fff';
                let teamName = TEAMS.find(t => t.id === d.team)?.name || d.team;
                
                if(d.team === 'reserve') {
                    const subTeams = new Set();
                    if(d.results) Object.values(d.results).forEach(r => {
                        if(typeof r === 'object' && r.team && r.team !== 'reserve') subTeams.add(TEAMS.find(t => t.id === r.team)?.name);
                    });
                    if(subTeams.size > 0) teamName += ` (${Array.from(subTeams).join(', ')})`;
                }

                tbody.innerHTML += `<tr style="--team-color: ${color}">
                    <td style="color:${i<3?['#FFD700','#C0C0C0','#CD7F32'][i]:'inherit'}">${String(i+1).padStart(2,'0')}</td>
                    <td style="font-weight:700">${d.name}</td>
                    <td style="text-transform:uppercase; font-size:0.8rem; letter-spacing:1px; opacity:0.8">${teamName}</td>
                    <td style="color:var(--accent-cyan); font-weight:700">${d.totalPoints}</td>
                </tr>`;
            });
        }

        // 2. CONSTRUCTOR STANDINGS (Main)
        function renderConstructors() {
            const teamPoints = {};
            TEAMS.forEach(t => { if(t.id !== 'reserve') teamPoints[t.id] = 0; });

            allDrivers.forEach(d => {
                const results = d.results || {};
                Object.values(results).forEach(r => {
                    let pts = 0;
                    let teamId = d.team;
                    if (typeof r === 'object') {
                        pts = Number(r.points || 0);
                        teamId = r.team || d.team;
                    } else {
                        pts = Number(r || 0);
                    }
                    if (teamId !== 'reserve' && teamPoints[teamId] !== undefined) {
                        teamPoints[teamId] += pts;
                    }
                });
            });

            const sortedTeams = Object.keys(teamPoints)
                .map(id => ({ id, name: TEAMS.find(t=>t.id===id).name, points: teamPoints[id] }))
                .sort((a,b) => b.points - a.points);

            document.getElementById('garage-grid').innerHTML = sortedTeams.map((c, i) => {
                const color = TEAM_COLORS[c.id];
                return `<div class="constructor-card hover-target" style="--team-color: ${color}">
                    <div class="cc-bg-rank">${String(i+1).padStart(2,'0')}</div>
                    <div class="cc-header"><span class="cc-name">${c.name}</span><span class="cc-points">${c.points} PTS</span></div>
                    <div class="cc-img-container"><img src="${CAR_IMAGES[c.id] || 'https://placehold.co/300x100?text=Car'}" class="cc-car-img"></div>
                </div>`;
            }).join('');
            
            if (!window.matchMedia("(pointer: coarse)").matches) {
                document.querySelectorAll('.constructor-card').forEach(card => {
                    card.addEventListener('mousemove', (e) => {
                        const rect = card.getBoundingClientRect();
                        const x = e.clientX - rect.left - rect.width/2;
                        const y = e.clientY - rect.top - rect.height/2;
                        gsap.to(card, { transform: `perspective(1000px) rotateX(${-y/10}deg) rotateY(${x/10}deg) scale3d(1.02, 1.02, 1.02)`, duration: 0.1 });
                    });
                    card.addEventListener('mouseleave', () => { gsap.to(card, { transform: `perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)`, duration: 0.5 }); });
                });
            }
        }

        // 3. ARCHIVE DRIVERS (Matrix)
        function renderArchiveDrivers() {
            const container = document.getElementById("archives-drivers-container");
            
            let html = `<table class="standings-table">`;
            html += `<thead><tr><th class="sticky-corner">DRIVER</th>`;
            TRACK_KEYS.forEach(k => {
                html += `<th class="sticky-top" style="text-align:center">${TRACK_LABELS[k]}</th>`;
            });
            html += `<th class="sticky-top" style="text-align:center">TOTAL</th></tr></thead><tbody>`;

            allDrivers.forEach(d => {
                const results = d.results || {};
                const tColor = TEAM_COLORS[d.team] || '#fff';
                
                html += `<tr style="--team-color: ${tColor}">`;
                html += `<td class="sticky-left" style="font-weight:700; background:var(--glass-bg); border-left:3px solid ${tColor}">${d.name}</td>`;
                
                let rowTotal = 0;
                TRACK_KEYS.forEach(k => {
                    let pts = '-';
                    if (results[k]) {
                        const val = typeof results[k] === 'object' ? results[k].points : results[k];
                        if (val > 0) { pts = val; rowTotal += val; }
                    }
                    html += `<td style="text-align:center; opacity:${pts === '-' ? 0.3 : 1}">${pts}</td>`;
                });
                
                html += `<td style="text-align:center; color:var(--accent-cyan); font-weight:700">${rowTotal}</td></tr>`;
            });
            html += `</tbody></table>`;
            container.innerHTML = html;
        }

        // 4. ARCHIVE TEAMS (Matrix)
        function renderArchiveTeams() {
            const container = document.getElementById("archives-teams-container");
            const teamTrackPoints = {};
            
            TEAMS.forEach(t => {
                if (t.id === 'reserve') return;
                teamTrackPoints[t.id] = { total: 0 };
                TRACK_KEYS.forEach(k => teamTrackPoints[t.id][k] = 0);
            });

            allDrivers.forEach(d => {
                const results = d.results || {};
                Object.keys(results).forEach(trackKey => {
                    if(!TRACK_KEYS.includes(trackKey)) return;
                    const r = results[trackKey];
                    let pts = 0, teamId = d.team;

                    if (typeof r === 'object') { pts = Number(r.points || 0); teamId = r.team || d.team; }
                    else { pts = Number(r || 0); }

                    if(teamId !== 'reserve' && teamTrackPoints[teamId]) {
                        teamTrackPoints[teamId][trackKey] += pts;
                        teamTrackPoints[teamId].total += pts;
                    }
                });
            });

            const sortedTeamIds = Object.keys(teamTrackPoints).sort((a,b) => teamTrackPoints[b].total - teamTrackPoints[a].total);

            let html = `<table class="standings-table">`;
            html += `<thead><tr><th class="sticky-corner">TEAM</th>`;
            TRACK_KEYS.forEach(k => html += `<th class="sticky-top" style="text-align:center">${TRACK_LABELS[k]}</th>`);
            html += `<th class="sticky-top" style="text-align:center">TOTAL</th></tr></thead><tbody>`;

            sortedTeamIds.forEach(tId => {
                const tColor = TEAM_COLORS[tId];
                const tName = TEAMS.find(t => t.id === tId)?.name;
                
                html += `<tr style="--team-color: ${tColor}">`;
                html += `<td class="sticky-left" style="font-weight:700; background:var(--glass-bg); border-left:3px solid ${tColor}; text-transform:uppercase;">${tName}</td>`;
                
                TRACK_KEYS.forEach(k => {
                    const pts = teamTrackPoints[tId][k];
                    html += `<td style="text-align:center; opacity:${pts === 0 ? 0.3 : 1}">${pts > 0 ? pts : '-'}</td>`;
                });
                html += `<td style="text-align:center; color:var(--accent-cyan); font-weight:700">${teamTrackPoints[tId].total}</td></tr>`;
            });
            html += `</tbody></table>`;
            container.innerHTML = html;
        }

        // --- CALENDAR & DOTD RENDERERS ---
        function renderCalendar() {
            document.getElementById('calendar-grid').innerHTML = CALENDAR.map(r => 
                `<div class="cal-item hover-target">
                    <span class="round">RD ${String(r.round).padStart(2,'0')}</span>
                    <span class="gp">${r.gp.toUpperCase()}</span>
                    <span class="date">${r.date}</span>
                    <button class="btn-ai-intel hover-target" onclick="fetchTrackIntel('${r.gp}')"><i class="fa-solid fa-wand-magic-sparkles"></i> STRATEGY</button>
                </div>`
            ).join('');
        }

        function renderDOTD() {
            document.getElementById('dotd-container').innerHTML = DOTD_DATA.map(d => {
                const tColor = TEAM_COLORS[d.team.toUpperCase().replace(' ', '-').toLowerCase()] || '#fff';
                return `<div class="dotd-panel" style="background-image: url('${d.image}'); --team-color: ${tColor}">
                    <div class="dotd-label">${d.driver.split(' ')[0]}</div>
                    <div class="dotd-badge-icon"><i class="fa-solid fa-award"></i></div>
                    <div class="dotd-content">
                        <div class="dotd-gp-name">${d.gp}</div>
                        <div class="dotd-driver-name">${d.driver}</div>
                        <div class="dotd-team-name" style="color:${tColor}">${d.team}</div>
                        <div class="mono-font" style="font-size:0.8rem; color:#ccc; margin-top:0.5rem;">${d.desc}</div>
                    </div>
                </div>`;
            }).join('');
        }

        // --- ANIMATIONS ---
        const slides = document.querySelectorAll('.slide');
        let currentIndex = 0;
        let isAnimating = false;

        function gotoSlide(index) {
            if (isAnimating || index === currentIndex) return;
            isAnimating = true;
            let nextIndex = index;
            const currentSlide = slides[currentIndex];
            const nextSlide = slides[nextIndex];
            
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.querySelectorAll('.nav-link')[index].classList.add('active');

            gsap.set(nextSlide, { zIndex: 20, visibility: 'visible', opacity: 0 });
            const tl = gsap.timeline({
                defaults: { ease: "power2.inOut", duration: 1.2 },
                onComplete: () => {
                    gsap.set(currentSlide, { visibility: 'hidden', zIndex: 1, opacity: 0 });
                    currentIndex = nextIndex;
                    isAnimating = false;
                }
            });
            tl.to(currentSlide, { scale: 0.9, opacity: 0, filter: 'brightness(0.5)' }, 0);
            tl.fromTo(nextSlide, { scale: 1.1, opacity: 0, filter: 'brightness(1.5)' }, { scale: 1, opacity: 1, filter: 'brightness(1)' }, "-=0.8");
            
            const elements = nextSlide.querySelectorAll('.slide-tag, .slide-title, .btn-container, .cal-item, .standings-wrapper, .contact-grid');
            gsap.fromTo(elements, { y: 50, opacity: 0 }, { y: 0, opacity: 1, duration: 0.8, stagger: 0.1, delay: 0.5 });
        }

        document.querySelectorAll('.nav-link').forEach((link, idx) => {
            link.addEventListener('click', (e) => { e.preventDefault(); gotoSlide(idx); });
        });
        document.getElementById('start-engine-btn').addEventListener('click', () => gotoSlide(1));
        document.getElementById('app-logo').addEventListener('click', () => gotoSlide(0));

        // GLOBAL TAB LISTENER
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const targetTab = e.target.dataset.tab;
                
                // Find parent container to scope active class removal (handle multiple tab groups)
                const parentGroup = e.target.closest('.standings-tabs') || e.target.parentNode;
                parentGroup.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                
                // Find relevant view container
                const wrapper = e.target.closest('.slide-content').querySelector('.standings-wrapper');
                if(wrapper) {
                    wrapper.querySelectorAll('.standings-view').forEach(v => v.classList.remove('active-view'));
                    const targetView = document.getElementById('view-'+targetTab);
                    if(targetView) {
                        targetView.classList.add('active-view');
                        
                        // Trigger specific render functions if needed on tab switch
                        if(targetTab === 'constructors') {
                             // constructor animations
                             gsap.fromTo('.constructor-card', {y: 50, opacity: 0}, {y: 0, opacity: 1, stagger: 0.1, duration: 0.5, clearProps: "all"});
                        } else if (targetTab === 'dotd' || targetTab === 'archive-dotd') {
                             gsap.fromTo('.dotd-panel', { width: "10%", opacity: 0 }, { width: "auto", opacity: 1, duration: 0.8, stagger: 0.05, ease: "power2.out", clearProps: "width" });
                        } else if (targetTab === 'archive-teams') {
                             renderArchiveTeams(); // Ensure updated
                        }
                    }
                }
            });
        });

        window.onload = () => {
            gsap.to('#load-bar', { width: '100%', duration: 1, onComplete: () => {
                gsap.to('#loader', { y: '-100%', duration: 0.8 });
                // Initialize Data (Default Season 1)
                initArchiveSync(null); 
                renderCalendar();
                renderDOTD();
            }});
            
            const cursor = document.getElementById('cursor');
            const follower = document.getElementById('cursor-follower');
            document.addEventListener('mousemove', (e) => {
                cursor.style.left = e.clientX + 'px'; cursor.style.top = e.clientY + 'px';
                gsap.to(follower, { x: e.clientX - 20, y: e.clientY - 20, duration: 0.1 });
            });
            
            VANTA.NET({
                el: "#vanta-bg", mouseControls: true, touchControls: true, gyroControls: false,
                minHeight: 200.00, minWidth: 200.00, scale: 1.00, scaleMobile: 1.00,
                color: 0x00f0ff, backgroundColor: 0x050505, points: 12.00, maxDistance: 22.00, spacing: 18.00
            });
        };
    </script>
</body>
</html>
